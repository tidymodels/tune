<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Getting Started with tune • tune</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="../tidyverse.css" rel="stylesheet">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../tidyverse-2.css" rel="stylesheet">
<meta property="og:title" content="Getting Started with tune">
<meta property="og:description" content="tune">
<meta property="og:image" content="https://tune.tidymodels.org/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../index.html">tune</a>
        <div class="info">
          <span class="partof">part of <a href="https://tidymodels.org">tidymodels</a></span>
          <span class="version version-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../articles/getting_started.html">Getting Started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/grid.html">Grid Search</a>
    </li>
    <li>
      <a href="../articles/acquisition_functions.html">Acquisition Functions</a>
    </li>
    <li>
      <a href="../articles/extras/svm_classification.html">Bayesian Optimization of Classification Model</a>
    </li>
    <li>
      <a href="../articles/extras/optimizations.html">Optimizations and Parallel Processing</a>
    </li>
    <li>
      <a href="../articles/extras/text_analysis.html">Text Analysis Example</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
        <li>
  <a href="https://github.com/tidymodels/tune/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="getting_started_files/header-attrs-2.1/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Getting Started with tune</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tidymodels/tune/blob/master/vignettes/getting_started.Rmd"><code>vignettes/getting_started.Rmd</code></a></small>
      <div class="hidden name"><code>getting_started.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>The <code>tune</code> package helps optimize the modeling process. Users can <em>tag</em> arguments in recipes and model objects for optimization. The search routines in <code>tune</code> can discover these arguments and evaluate candidate values until a combination with good performance is found.</p>
<p>As an example, let’s model the Ames housing data:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidymodels</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tune</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">AmesHousing</span>)

<span class="no">ames</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/AmesHousing/man/make_ames.html">make_ames</a></span>()

<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">4595</span>)
<span class="no">data_split</span> <span class="kw">&lt;-</span> <span class="fu">initial_split</span>(<span class="no">ames</span>, <span class="kw">strata</span> <span class="kw">=</span> <span class="st">"Sale_Price"</span>)
<span class="no">ames_train</span> <span class="kw">&lt;-</span> <span class="fu">training</span>(<span class="no">data_split</span>)
<span class="no">ames_test</span>  <span class="kw">&lt;-</span> <span class="fu">testing</span>(<span class="no">data_split</span>)</pre></body></html></div>
<p>For simplicity, the sale price of a house will be modeled as a function of its geo-location. These predictors appear to have nonlinear relationships with the outcome:</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">ames_train</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">Sale_Price</span>, <span class="no">Longitude</span>, <span class="no">Latitude</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">tidyr</span><span class="kw ns">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span>(<span class="kw">cols</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">Longitude</span>, <span class="no">Latitude</span>),
                      <span class="kw">names_to</span> <span class="kw">=</span> <span class="st">"predictor"</span>, <span class="kw">values_to</span> <span class="kw">=</span> <span class="st">"value"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">value</span>, <span class="no">Sale_Price</span>)) +
  <span class="fu">geom_point</span>(<span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">.2</span>) +
  <span class="fu">geom_smooth</span>(<span class="kw">se</span> <span class="kw">=</span> <span class="fl">FALSE</span>) +
  <span class="fu">scale_y_log10</span>() +
  <span class="fu">facet_wrap</span>(~ <span class="no">predictor</span>, <span class="kw">scales</span> <span class="kw">=</span> <span class="st">"free_x"</span>)
<span class="co">#&gt; `geom_smooth()` using method = 'gam' and formula 'y ~ s(x, bs = "cs")'</span></pre></body></html></div>
<p><img src="getting_started_files/figure-html/geo-plots-1.png" width="768"></p>
<p>These two predictors could be modeled using <a href="https://towardsdatascience.com/numerical-interpolation-natural-cubic-spline-52c1157b98ac">natural splines</a> in conjunction with a linear model. The amount of “wiggliness” in these splines is determined by the degrees of freedom. An appropriate value of this parameter cannot be analytically determined from the data, so it is a <em>tuning parameter</em> (a.k.a. a hyper-parameter). A common approach is to use resampling to estimate model performance over different values of these parameters and use these results to set reasonable values.</p>
<p>We can tag these parameters for optimization using the <code><a href="../reference/tune.html">tune()</a></code> function:</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">ames_rec</span> <span class="kw">&lt;-</span>
  <span class="fu">recipe</span>(<span class="no">Sale_Price</span> ~ <span class="no">Longitude</span> + <span class="no">Latitude</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">ames_train</span>) <span class="kw">%&gt;%</span>
  <span class="fu">step_log</span>(<span class="no">Sale_Price</span>, <span class="kw">base</span> <span class="kw">=</span> <span class="fl">10</span>) <span class="kw">%&gt;%</span>
  <span class="fu">step_ns</span>(<span class="no">Longitude</span>, <span class="no">Latitude</span>, <span class="kw">deg_free</span> <span class="kw">=</span> <span class="fu"><a href="../reference/tune.html">tune</a></span>())</pre></body></html></div>
<p>The package can detect these values and optimize them.</p>
<p>However, based on the plot above, the potential <em>amount</em> of non-linearity between the sale price and the predictors might be different. For example, longitude might require more flexibility than latitude. The recipe above would constrain the nonlinearity of the predictors to be the same. We can probably do better than that.</p>
<p>To accomplish this, individual <code>step_ns()</code> terms can be added to the recipe for each predictor. However, we want these to be identifiable; using the same syntax as above, we can’t tell the difference between the two <code>deg_free</code> parameters.</p>
<p><code><a href="../reference/tune.html">tune()</a></code> has an option to provide a text annotation so that each tuning parameter has a unique identifier:</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">ames_rec</span> <span class="kw">&lt;-</span>
  <span class="fu">recipe</span>(<span class="no">Sale_Price</span> ~ <span class="no">Longitude</span> + <span class="no">Latitude</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">ames_train</span>) <span class="kw">%&gt;%</span>
  <span class="fu">step_log</span>(<span class="no">Sale_Price</span>, <span class="kw">base</span> <span class="kw">=</span> <span class="fl">10</span>) <span class="kw">%&gt;%</span>
  <span class="fu">step_ns</span>(<span class="no">Longitude</span>, <span class="kw">deg_free</span> <span class="kw">=</span> <span class="fu"><a href="../reference/tune.html">tune</a></span>(<span class="st">"long df"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">step_ns</span>(<span class="no">Latitude</span>,  <span class="kw">deg_free</span> <span class="kw">=</span> <span class="fu"><a href="../reference/tune.html">tune</a></span>(<span class="st">"lat df"</span>))</pre></body></html></div>
<p>The function <code><a href="https://rdrr.io/pkg/dials/man/parameters.html">dials::parameters()</a></code> that can detect and collect the parameters that have been flagged for tuning:</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/dials/man/parameters.html">parameters</a></span>(<span class="no">ames_rec</span>)
<span class="co">#&gt; Collection of 2 parameters for tuning</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;       id parameter type object class</span>
<span class="co">#&gt;  long df       deg_free    nparam[+]</span>
<span class="co">#&gt;   lat df       deg_free    nparam[+]</span></pre></body></html></div>
<p>The <code>dials</code> package has default ranges for many parameters. The generic parameter function for <code>deg_free</code> has a fairly small range:</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu">deg_free</span>()
<span class="co">#&gt; Degrees of Freedom  (quantitative)</span>
<span class="co">#&gt; Range: [1, 5]</span></pre></body></html></div>
<p>but there is a <code>dials</code> function that is more appropriate for splines:</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="fu">spline_degree</span>()
<span class="co">#&gt; Piecewise Polynomial Degree  (quantitative)</span>
<span class="co">#&gt; Range: [3, 10]</span></pre></body></html></div>
<p>The parameter objects can be easily changed using the <code><a href="https://rdrr.io/r/stats/update.html">update()</a></code> function:</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">ames_param</span> <span class="kw">&lt;-</span>
  <span class="no">ames_rec</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dials/man/parameters.html">parameters</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span>(
    <span class="kw">`long df`</span> <span class="kw">=</span> <span class="fu">spline_degree</span>(),
    <span class="kw">`lat df`</span> <span class="kw">=</span> <span class="fu">spline_degree</span>()
  )
<span class="no">ames_param</span>
<span class="co">#&gt; Collection of 2 parameters for tuning</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;       id parameter type object class</span>
<span class="co">#&gt;  long df       deg_free    nparam[+]</span>
<span class="co">#&gt;   lat df       deg_free    nparam[+]</span></pre></body></html></div>
</div>
<div id="grid-search" class="section level2">
<h2 class="hasAnchor">
<a href="#grid-search" class="anchor"></a>Grid Search</h2>
<p>Grid search uses a pre-defined set of candidate parameters and evaluates these using resampling. The basic ingredients are:</p>
<ul>
<li><p>A grid of candidate values to evaluate.</p></li>
<li><p>One or more performance metrics for quantifying how well the model works.</p></li>
<li><p>A resampling scheme that can be used to appropriately measure performance (which could be a simple validation set).</p></li>
</ul>
<p>To make the grid, a data frame is needed with column names matching the “id” column above. There are several <code>dials</code> functions to created grids (named <code>grid_*</code>). For example, a space-filling design can be created by:</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">spline_grid</span> <span class="kw">&lt;-</span> <span class="fu">grid_max_entropy</span>(<span class="no">ames_param</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">10</span>)
<span class="no">spline_grid</span>
<span class="co">#&gt; # A tibble: 10 x 2</span>
<span class="co">#&gt;    `long df` `lat df`</span>
<span class="co">#&gt;        &lt;int&gt;    &lt;int&gt;</span>
<span class="co">#&gt;  1         3        9</span>
<span class="co">#&gt;  2         5        7</span>
<span class="co">#&gt;  3         6       10</span>
<span class="co">#&gt;  4         8        6</span>
<span class="co">#&gt;  5         8        3</span>
<span class="co">#&gt;  6         8        8</span>
<span class="co">#&gt;  7        10        7</span>
<span class="co">#&gt;  8         4        6</span>
<span class="co">#&gt;  9         5        3</span>
<span class="co">#&gt; 10         9       10</span></pre></body></html></div>
<p>Alternately, <code><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid()</a></code> also works to create a regular grid:</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">df_vals</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">2</span>, <span class="fl">18</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="fl">2</span>)
<span class="co"># A regular grid:</span>
<span class="no">spline_grid</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span>(<span class="kw">`long df`</span> <span class="kw">=</span> <span class="no">df_vals</span>, <span class="kw">`lat df`</span> <span class="kw">=</span> <span class="no">df_vals</span>)</pre></body></html></div>
<p>Note that a 2-degree-of-freedom model is a simple quadratic fit.</p>
<p>There are two other ingredients that are required before tuning.</p>
<p>First is a model specification. Using <code>parsnip</code>, a basic linear model can be used:</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">lm_mod</span> <span class="kw">&lt;-</span> <span class="fu">linear_reg</span>() <span class="kw">%&gt;%</span> <span class="fu">set_engine</span>(<span class="st">"lm"</span>)</pre></body></html></div>
<p>No tuning parameters here.</p>
<p>As mentioned above, a resampling specification is also needed. The Ames data set are large enough to use simple 10-fold cross-validation:</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">2453</span>)
<span class="no">cv_splits</span> <span class="kw">&lt;-</span> <span class="fu">vfold_cv</span>(<span class="no">ames_train</span>, <span class="kw">v</span> <span class="kw">=</span> <span class="fl">10</span>, <span class="kw">strata</span> <span class="kw">=</span> <span class="st">"Sale_Price"</span>)</pre></body></html></div>
<p>The root mean squared error will be used to measure performance (and this is the default for regression problems).</p>
<p>Using these objects, <code><a href="../reference/tune_grid.html">tune_grid()</a></code> can be used<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>:</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">ames_res</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/tune_grid.html">tune_grid</a></span>(<span class="no">lm_mod</span>, <span class="no">ames_rec</span>, <span class="kw">resamples</span> <span class="kw">=</span> <span class="no">cv_splits</span>, <span class="kw">grid</span> <span class="kw">=</span> <span class="no">spline_grid</span>)</pre></body></html></div>
<p>The object is similar to the <code>rsample</code> object but with one or more extra columns:</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">ames_res</span>
<span class="co">#&gt; #  10-fold cross-validation using stratification </span>
<span class="co">#&gt; # A tibble: 10 x 4</span>
<span class="co">#&gt;    splits           id     .metrics           .notes          </span>
<span class="co">#&gt;    &lt;list&gt;           &lt;chr&gt;  &lt;list&gt;             &lt;list&gt;          </span>
<span class="co">#&gt;  1 &lt;split [2K/221]&gt; Fold01 &lt;tibble [162 × 5]&gt; &lt;tibble [0 × 1]&gt;</span>
<span class="co">#&gt;  2 &lt;split [2K/220]&gt; Fold02 &lt;tibble [162 × 5]&gt; &lt;tibble [0 × 1]&gt;</span>
<span class="co">#&gt;  3 &lt;split [2K/220]&gt; Fold03 &lt;tibble [162 × 5]&gt; &lt;tibble [0 × 1]&gt;</span>
<span class="co">#&gt;  4 &lt;split [2K/220]&gt; Fold04 &lt;tibble [162 × 5]&gt; &lt;tibble [0 × 1]&gt;</span>
<span class="co">#&gt;  5 &lt;split [2K/220]&gt; Fold05 &lt;tibble [162 × 5]&gt; &lt;tibble [0 × 1]&gt;</span>
<span class="co">#&gt;  6 &lt;split [2K/220]&gt; Fold06 &lt;tibble [162 × 5]&gt; &lt;tibble [0 × 1]&gt;</span>
<span class="co">#&gt;  7 &lt;split [2K/220]&gt; Fold07 &lt;tibble [162 × 5]&gt; &lt;tibble [0 × 1]&gt;</span>
<span class="co">#&gt;  8 &lt;split [2K/220]&gt; Fold08 &lt;tibble [162 × 5]&gt; &lt;tibble [0 × 1]&gt;</span>
<span class="co">#&gt;  9 &lt;split [2K/220]&gt; Fold09 &lt;tibble [162 × 5]&gt; &lt;tibble [0 × 1]&gt;</span>
<span class="co">#&gt; 10 &lt;split [2K/218]&gt; Fold10 &lt;tibble [162 × 5]&gt; &lt;tibble [0 × 1]&gt;</span></pre></body></html></div>
<p>The <code>.metrics</code> column has all of the holdout performance estimates<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> for each parameter combination:</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">ames_res</span>$<span class="no">.metrics</span><span class="kw">[[</span><span class="fl">1</span>]]
<span class="co">#&gt; # A tibble: 162 x 5</span>
<span class="co">#&gt;    `long df` `lat df` .metric .estimator .estimate</span>
<span class="co">#&gt;        &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;</span>
<span class="co">#&gt;  1         2        2 rmse    standard       0.150</span>
<span class="co">#&gt;  2         2        2 rsq     standard       0.362</span>
<span class="co">#&gt;  3         4        2 rmse    standard       0.150</span>
<span class="co">#&gt;  4         4        2 rsq     standard       0.360</span>
<span class="co">#&gt;  5         6        2 rmse    standard       0.146</span>
<span class="co">#&gt;  6         6        2 rsq     standard       0.395</span>
<span class="co">#&gt;  7         8        2 rmse    standard       0.145</span>
<span class="co">#&gt;  8         8        2 rsq     standard       0.399</span>
<span class="co">#&gt;  9        10        2 rmse    standard       0.144</span>
<span class="co">#&gt; 10        10        2 rsq     standard       0.406</span>
<span class="co">#&gt; # … with 152 more rows</span></pre></body></html></div>
<p>To get the average metric value for each parameter combination, <code><a href="../reference/collect_predictions.html">collect_metrics()</a></code> can be put to use:</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="no">estimates</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/collect_predictions.html">collect_metrics</a></span>(<span class="no">ames_res</span>)
<span class="no">estimates</span>
<span class="co">#&gt; # A tibble: 162 x 7</span>
<span class="co">#&gt;    `long df` `lat df` .metric .estimator  mean     n std_err</span>
<span class="co">#&gt;        &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt;  1         2        2 rmse    standard   0.144    10 0.00221</span>
<span class="co">#&gt;  2         2        2 rsq     standard   0.351    10 0.0158 </span>
<span class="co">#&gt;  3         2        4 rmse    standard   0.143    10 0.00233</span>
<span class="co">#&gt;  4         2        4 rsq     standard   0.356    10 0.0156 </span>
<span class="co">#&gt;  5         2        6 rmse    standard   0.143    10 0.00221</span>
<span class="co">#&gt;  6         2        6 rsq     standard   0.363    10 0.0161 </span>
<span class="co">#&gt;  7         2        8 rmse    standard   0.136    10 0.00246</span>
<span class="co">#&gt;  8         2        8 rsq     standard   0.422    10 0.0164 </span>
<span class="co">#&gt;  9         2       10 rmse    standard   0.136    10 0.00244</span>
<span class="co">#&gt; 10         2       10 rsq     standard   0.419    10 0.0160 </span>
<span class="co">#&gt; # … with 152 more rows</span></pre></body></html></div>
<p>The values in the <code>mean</code> column are the averages of the 10 resamples. The best RMSE values corresponded to:</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="no">rmse_vals</span> <span class="kw">&lt;-</span>
  <span class="no">estimates</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">.metric</span> <span class="kw">==</span> <span class="st">"rmse"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">arrange</span>(<span class="no">mean</span>)
<span class="no">rmse_vals</span>
<span class="co">#&gt; # A tibble: 81 x 7</span>
<span class="co">#&gt;    `long df` `lat df` .metric .estimator  mean     n std_err</span>
<span class="co">#&gt;        &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt;  1        16       16 rmse    standard   0.128    10 0.00244</span>
<span class="co">#&gt;  2        16       18 rmse    standard   0.128    10 0.00247</span>
<span class="co">#&gt;  3        16       12 rmse    standard   0.128    10 0.00235</span>
<span class="co">#&gt;  4        18       16 rmse    standard   0.128    10 0.00239</span>
<span class="co">#&gt;  5        18       18 rmse    standard   0.128    10 0.00242</span>
<span class="co">#&gt;  6        16       14 rmse    standard   0.128    10 0.00229</span>
<span class="co">#&gt;  7        18       12 rmse    standard   0.128    10 0.00231</span>
<span class="co">#&gt;  8        16        8 rmse    standard   0.129    10 0.00240</span>
<span class="co">#&gt;  9        12       16 rmse    standard   0.129    10 0.00253</span>
<span class="co">#&gt; 10        18       14 rmse    standard   0.129    10 0.00225</span>
<span class="co">#&gt; # … with 71 more rows</span></pre></body></html></div>
<p>Smaller degrees of freedom values correspond to more linear functions, but the grid search indicates that more nonlinearity is better. What was the relationship between these two parameters and RMSE?</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="no">rmse_vals</span> <span class="kw">%&gt;%</span>
  <span class="co"># convert to factors for easier plotting</span>
  <span class="fu">mutate</span>(<span class="kw">`lat df`</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span>(<span class="no">`lat df`</span>))) <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">`long df`</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">mean</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="no">`lat df`</span>)) +
  <span class="fu">geom_point</span>() +
  <span class="fu">geom_line</span>() +
  <span class="fu">ylab</span>(<span class="st">"Mean RMSE"</span>)</pre></body></html></div>
<p><img src="getting_started_files/figure-html/rmse-tile-1.png" width="768"></p>
<p>Interestingly, latitude does <em>not</em> do well with degrees of freedom less than 8. How nonlinear are the optimal degrees of freedom?</p>
<p>Let’s plot these spline functions over the data for booth good and bad values of <code>deg_free</code>:</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="no">ames_train</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">Sale_Price</span>, <span class="no">Longitude</span>, <span class="no">Latitude</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">tidyr</span><span class="kw ns">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span>(<span class="kw">cols</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">Longitude</span>, <span class="no">Latitude</span>),
                      <span class="kw">names_to</span> <span class="kw">=</span> <span class="st">"predictor"</span>, <span class="kw">values_to</span> <span class="kw">=</span> <span class="st">"value"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">value</span>, <span class="no">Sale_Price</span>)) +
  <span class="fu">geom_point</span>(<span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">.2</span>) +
  <span class="fu">geom_smooth</span>(<span class="kw">se</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="no">lm</span>, <span class="kw">formula</span> <span class="kw">=</span> <span class="no">y</span> ~ <span class="kw pkg">splines</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/splines/ns.html">ns</a></span>(<span class="no">x</span>, <span class="kw">df</span> <span class="kw">=</span> <span class="fl">3</span>),  <span class="kw">col</span> <span class="kw">=</span> <span class="st">"red"</span>)  +
  <span class="fu">geom_smooth</span>(<span class="kw">se</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="no">lm</span>, <span class="kw">formula</span> <span class="kw">=</span> <span class="no">y</span> ~ <span class="kw pkg">splines</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/splines/ns.html">ns</a></span>(<span class="no">x</span>, <span class="kw">df</span> <span class="kw">=</span> <span class="fl">16</span>)) +
  <span class="fu">scale_y_log10</span>() +
  <span class="fu">facet_wrap</span>(~ <span class="no">predictor</span>, <span class="kw">scales</span> <span class="kw">=</span> <span class="st">"free_x"</span>)</pre></body></html></div>
<p><img src="getting_started_files/figure-html/final-vals-1.png" width="768"></p>
<p>Looking at these plots, the smaller degrees of freedom (red) are clearly under-fitting. Visually, the more complex splines (blue) might indicate that there is overfitting but this would result in poor RMSE values when computed on the hold-out data.</p>
<p>Based on these results, a new recipe would be created with the optimized values (using the entire training set) and this would be combined with a linear model created form the entire training set.</p>
</div>
<div id="model-optimization" class="section level2">
<h2 class="hasAnchor">
<a href="#model-optimization" class="anchor"></a>Model Optimization</h2>
<p>Instead of a linear regression, a nonlinear model might provide good performance. A K-nearest-neighbor fit will also be optimized. For this example, the number of neighbors and the distance weighting function will be optimized:</p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="co"># requires the kknn package</span>
<span class="no">knn_mod</span> <span class="kw">&lt;-</span>
  <span class="fu">nearest_neighbor</span>(<span class="kw">neighbors</span> <span class="kw">=</span> <span class="fu"><a href="../reference/tune.html">tune</a></span>(), <span class="kw">weight_func</span> <span class="kw">=</span> <span class="fu"><a href="../reference/tune.html">tune</a></span>()) <span class="kw">%&gt;%</span>
  <span class="fu">set_engine</span>(<span class="st">"kknn"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">set_mode</span>(<span class="st">"regression"</span>)</pre></body></html></div>
<p>The easiest approach to optimize the pre-processing and model parameters is to bundle these objects into a <em>workflow</em>:</p>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">workflows</span>)
<span class="no">knn_wflow</span> <span class="kw">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/pkg/workflows/man/workflow.html">workflow</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/workflows/man/add_model.html">add_model</a></span>(<span class="no">knn_mod</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/workflows/man/add_recipe.html">add_recipe</a></span>(<span class="no">ames_rec</span>)</pre></body></html></div>
<p>From this, the parameter set can be used to modify the range and values of parameters being optimized<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>:</p>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="no">knn_param</span> <span class="kw">&lt;-</span>
  <span class="no">knn_wflow</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/dials/man/parameters.html">parameters</a></span>() <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span>(
    <span class="kw">`long df`</span> <span class="kw">=</span> <span class="fu">spline_degree</span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>, <span class="fl">18</span>)),
    <span class="kw">`lat df`</span> <span class="kw">=</span> <span class="fu">spline_degree</span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>, <span class="fl">18</span>)),
    <span class="kw">neighbors</span> <span class="kw">=</span> <span class="fu">neighbors</span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">3</span>, <span class="fl">50</span>)),
    <span class="kw">weight_func</span> <span class="kw">=</span> <span class="fu">weight_func</span>(<span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"rectangular"</span>, <span class="st">"inv"</span>, <span class="st">"gaussian"</span>, <span class="st">"triangular"</span>))
  )</pre></body></html></div>
<p>This parameter collection can be passed to the grid functions via the <code>param_info</code> arguments.</p>
<p>Instead of using grid search, an iterative method called <a href="http://krasserm.github.io/2018/03/21/bayesian-optimization/">Bayesian optimization</a> can be used. This takes an initial set of results and tries to predict the next tuning parameters to evaluate.</p>
<p>Although no grid is required, the process requires a few additional pieces of information:</p>
<ul>
<li><p>A description of the search space. At a minimum, the would consist of ranges for numeric values and a list of values for categorical tuning parameters.</p></li>
<li><p>An <a href="https://tidymodels.github.io/tune/articles/acquisition_functions.html">acquisition function</a> that helps score potential tuning parameter values.</p></li>
<li><p>A model for analyzing and making predictions of the best tuning parameter values. A Gaussian Process model is typical and used here.</p></li>
</ul>
<p>The code to conduct the search is:</p>
<div class="sourceCode" id="cb23"><html><body><pre class="r"><span class="no">ctrl</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/control_bayes.html">control_bayes</a></span>(<span class="kw">verbose</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">8154</span>)
<span class="no">knn_search</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/tune_bayes.html">tune_bayes</a></span>(<span class="no">knn_wflow</span>, <span class="kw">resamples</span> <span class="kw">=</span> <span class="no">cv_splits</span>, <span class="kw">initial</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">iter</span> <span class="kw">=</span> <span class="fl">20</span>,
                         <span class="kw">param_info</span> <span class="kw">=</span> <span class="no">knn_param</span>, <span class="kw">control</span> <span class="kw">=</span> <span class="no">ctrl</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; &gt;  Generating a set of 5 initial parameter results</span>
<span class="co">#&gt; ✓ Initialization complete</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Optimizing rmse using the expected improvement</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Iteration 1 ──────────────────────────────────────────────────────────────────────────────────────────────────</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; i Current best:      rmse=0.09869 (@iter 0)</span>
<span class="co">#&gt; i Gaussian process model</span>
<span class="co">#&gt; ✓ Gaussian process model</span>
<span class="co">#&gt; i Generating 4733 candidates</span>
<span class="co">#&gt; i Predicted candidates</span>
<span class="co">#&gt; i neighbors=19, weight_func=gaussian, long df=5, lat df=7</span>
<span class="co">#&gt; i Estimating performance</span>
<span class="co">#&gt; ✓ Estimating performance</span>
<span class="co">#&gt; ⓧ Newest results:    rmse=0.101 (+/-0.00284)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Iteration 2 ──────────────────────────────────────────────────────────────────────────────────────────────────</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; i Current best:      rmse=0.09869 (@iter 0)</span>
<span class="co">#&gt; i Gaussian process model</span>
<span class="co">#&gt; ✓ Gaussian process model</span>
<span class="co">#&gt; i Generating 4764 candidates</span>
<span class="co">#&gt; i Predicted candidates</span>
<span class="co">#&gt; i neighbors=50, weight_func=rectangular, long df=3, lat df=16</span>
<span class="co">#&gt; i Estimating performance</span>
<span class="co">#&gt; ✓ Estimating performance</span>
<span class="co">#&gt; ⓧ Newest results:    rmse=0.1276 (+/-0.00268)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Iteration 3 ──────────────────────────────────────────────────────────────────────────────────────────────────</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; i Current best:      rmse=0.09869 (@iter 0)</span>
<span class="co">#&gt; i Gaussian process model</span>
<span class="co">#&gt; ✓ Gaussian process model</span>
<span class="co">#&gt; i Generating 4768 candidates</span>
<span class="co">#&gt; i Predicted candidates</span>
<span class="co">#&gt; i neighbors=16, weight_func=inv, long df=18, lat df=8</span>
<span class="co">#&gt; i Estimating performance</span>
<span class="co">#&gt; ✓ Estimating performance</span>
<span class="co">#&gt; ♥ Newest results:    rmse=0.09808 (+/-0.00297)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Iteration 4 ──────────────────────────────────────────────────────────────────────────────────────────────────</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; i Current best:      rmse=0.09808 (@iter 3)</span>
<span class="co">#&gt; i Gaussian process model</span>
<span class="co">#&gt; ✓ Gaussian process model</span>
<span class="co">#&gt; i Generating 4771 candidates</span>
<span class="co">#&gt; i Predicted candidates</span>
<span class="co">#&gt; i neighbors=3, weight_func=rectangular, long df=2, lat df=14</span>
<span class="co">#&gt; i Estimating performance</span>
<span class="co">#&gt; ✓ Estimating performance</span>
<span class="co">#&gt; ⓧ Newest results:    rmse=0.1099 (+/-0.00402)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Iteration 5 ──────────────────────────────────────────────────────────────────────────────────────────────────</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; i Current best:      rmse=0.09808 (@iter 3)</span>
<span class="co">#&gt; i Gaussian process model</span>
<span class="co">#&gt; ✓ Gaussian process model</span>
<span class="co">#&gt; i Generating 4781 candidates</span>
<span class="co">#&gt; i Predicted candidates</span>
<span class="co">#&gt; i neighbors=50, weight_func=gaussian, long df=18, lat df=14</span>
<span class="co">#&gt; i Estimating performance</span>
<span class="co">#&gt; ✓ Estimating performance</span>
<span class="co">#&gt; ⓧ Newest results:    rmse=0.1051 (+/-0.00288)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Iteration 6 ──────────────────────────────────────────────────────────────────────────────────────────────────</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; i Current best:      rmse=0.09808 (@iter 3)</span>
<span class="co">#&gt; i Gaussian process model</span>
<span class="co">#&gt; ✓ Gaussian process model</span>
<span class="co">#&gt; i Generating 4776 candidates</span>
<span class="co">#&gt; i Predicted candidates</span>
<span class="co">#&gt; i neighbors=4, weight_func=rectangular, long df=18, lat df=3</span>
<span class="co">#&gt; i Estimating performance</span>
<span class="co">#&gt; ✓ Estimating performance</span>
<span class="co">#&gt; ⓧ Newest results:    rmse=0.1063 (+/-0.00331)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Iteration 7 ──────────────────────────────────────────────────────────────────────────────────────────────────</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; i Current best:      rmse=0.09808 (@iter 3)</span>
<span class="co">#&gt; i Gaussian process model</span>
<span class="co">#&gt; ✓ Gaussian process model</span>
<span class="co">#&gt; i Generating 4764 candidates</span>
<span class="co">#&gt; i Predicted candidates</span>
<span class="co">#&gt; i neighbors=48, weight_func=rectangular, long df=18, lat df=11</span>
<span class="co">#&gt; i Estimating performance</span>
<span class="co">#&gt; ✓ Estimating performance</span>
<span class="co">#&gt; ⓧ Newest results:    rmse=0.1191 (+/-0.00276)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Iteration 8 ──────────────────────────────────────────────────────────────────────────────────────────────────</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; i Current best:      rmse=0.09808 (@iter 3)</span>
<span class="co">#&gt; i Gaussian process model</span>
<span class="co">#&gt; ✓ Gaussian process model</span>
<span class="co">#&gt; i Generating 4784 candidates</span>
<span class="co">#&gt; i Predicted candidates</span>
<span class="co">#&gt; i neighbors=3, weight_func=inv, long df=2, lat df=10</span>
<span class="co">#&gt; i Estimating performance</span>
<span class="co">#&gt; ✓ Estimating performance</span>
<span class="co">#&gt; ⓧ Newest results:    rmse=0.1065 (+/-0.0034)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Iteration 9 ──────────────────────────────────────────────────────────────────────────────────────────────────</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; i Current best:      rmse=0.09808 (@iter 3)</span>
<span class="co">#&gt; i Gaussian process model</span>
<span class="co">#&gt; ✓ Gaussian process model</span>
<span class="co">#&gt; i Generating 4772 candidates</span>
<span class="co">#&gt; i Predicted candidates</span>
<span class="co">#&gt; i neighbors=19, weight_func=gaussian, long df=18, lat df=11</span>
<span class="co">#&gt; i Estimating performance</span>
<span class="co">#&gt; ✓ Estimating performance</span>
<span class="co">#&gt; ⓧ Newest results:    rmse=0.1006 (+/-0.00316)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Iteration 10 ─────────────────────────────────────────────────────────────────────────────────────────────────</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; i Current best:      rmse=0.09808 (@iter 3)</span>
<span class="co">#&gt; i Gaussian process model</span>
<span class="co">#&gt; ✓ Gaussian process model</span>
<span class="co">#&gt; i Generating 4767 candidates</span>
<span class="co">#&gt; i Predicted candidates</span>
<span class="co">#&gt; i neighbors=50, weight_func=gaussian, long df=2, lat df=10</span>
<span class="co">#&gt; i Estimating performance</span>
<span class="co">#&gt; ✓ Estimating performance</span>
<span class="co">#&gt; ⓧ Newest results:    rmse=0.1152 (+/-0.00285)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Iteration 11 ─────────────────────────────────────────────────────────────────────────────────────────────────</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; i Current best:      rmse=0.09808 (@iter 3)</span>
<span class="co">#&gt; i Gaussian process model</span>
<span class="co">#&gt; ✓ Gaussian process model</span>
<span class="co">#&gt; i Generating 4783 candidates</span>
<span class="co">#&gt; i Predicted candidates</span>
<span class="co">#&gt; i neighbors=50, weight_func=inv, long df=17, lat df=3</span>
<span class="co">#&gt; i Estimating performance</span>
<span class="co">#&gt; ✓ Estimating performance</span>
<span class="co">#&gt; ⓧ Newest results:    rmse=0.1063 (+/-0.00279)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Iteration 12 ─────────────────────────────────────────────────────────────────────────────────────────────────</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; i Current best:      rmse=0.09808 (@iter 3)</span>
<span class="co">#&gt; i Gaussian process model</span>
<span class="co">#&gt; ✓ Gaussian process model</span>
<span class="co">#&gt; i Generating 4759 candidates</span>
<span class="co">#&gt; i Predicted candidates</span>
<span class="co">#&gt; i neighbors=29, weight_func=rectangular, long df=2, lat df=16</span>
<span class="co">#&gt; i Estimating performance</span>
<span class="co">#&gt; ✓ Estimating performance</span>
<span class="co">#&gt; ⓧ Newest results:    rmse=0.1263 (+/-0.00272)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Iteration 13 ─────────────────────────────────────────────────────────────────────────────────────────────────</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; i Current best:      rmse=0.09808 (@iter 3)</span>
<span class="co">#&gt; i Gaussian process model</span>
<span class="co">#&gt; ✓ Gaussian process model</span>
<span class="co">#&gt; i Generating 4758 candidates</span>
<span class="co">#&gt; i Predicted candidates</span>
<span class="co">#&gt; i neighbors=24, weight_func=inv, long df=2, lat df=7</span>
<span class="co">#&gt; i Estimating performance</span>
<span class="co">#&gt; ✓ Estimating performance</span>
<span class="co">#&gt; ⓧ Newest results:    rmse=0.1011 (+/-0.00304)</span>
<span class="co">#&gt; ! No improvement for 10 iterations; returning current results.</span></pre></body></html></div>
<p>Visually, the performance gain was:</p>
<div class="sourceCode" id="cb24"><html><body><pre class="r"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span>(<span class="no">knn_search</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"performance"</span>, <span class="kw">metric</span> <span class="kw">=</span> <span class="st">"rmse"</span>)</pre></body></html></div>
<p><img src="getting_started_files/figure-html/bo-iter-1.png" width="768"></p>
<p>The best results here were:</p>
<div class="sourceCode" id="cb25"><html><body><pre class="r"><span class="fu"><a href="../reference/collect_predictions.html">collect_metrics</a></span>(<span class="no">knn_search</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">.metric</span> <span class="kw">==</span> <span class="st">"rmse"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">arrange</span>(<span class="no">mean</span>)
<span class="co">#&gt; # A tibble: 18 x 10</span>
<span class="co">#&gt;    neighbors weight_func `long df` `lat df` .iter .metric .estimator   mean</span>
<span class="co">#&gt;        &lt;int&gt; &lt;chr&gt;           &lt;int&gt;    &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt;</span>
<span class="co">#&gt;  1        16 inv                18        8     3 rmse    standard   0.0981</span>
<span class="co">#&gt;  2        28 inv                16       10     0 rmse    standard   0.0987</span>
<span class="co">#&gt;  3        19 gaussian           18       11     9 rmse    standard   0.101 </span>
<span class="co">#&gt;  4         5 triangular          8       14     0 rmse    standard   0.101 </span>
<span class="co">#&gt;  5        19 gaussian            5        7     1 rmse    standard   0.101 </span>
<span class="co">#&gt;  6        24 inv                 2        7    13 rmse    standard   0.101 </span>
<span class="co">#&gt;  7        36 triangular          9        6     0 rmse    standard   0.104 </span>
<span class="co">#&gt;  8        50 gaussian           18       14     5 rmse    standard   0.105 </span>
<span class="co">#&gt;  9        50 inv                17        3    11 rmse    standard   0.106 </span>
<span class="co">#&gt; 10         4 rectangular        18        3     6 rmse    standard   0.106 </span>
<span class="co">#&gt; 11         3 inv                 2       10     8 rmse    standard   0.107 </span>
<span class="co">#&gt; 12        47 inv                 3       16     0 rmse    standard   0.108 </span>
<span class="co">#&gt; 13         3 rectangular         2       14     4 rmse    standard   0.110 </span>
<span class="co">#&gt; 14        18 rectangular        13        3     0 rmse    standard   0.114 </span>
<span class="co">#&gt; 15        50 gaussian            2       10    10 rmse    standard   0.115 </span>
<span class="co">#&gt; 16        48 rectangular        18       11     7 rmse    standard   0.119 </span>
<span class="co">#&gt; 17        29 rectangular         2       16    12 rmse    standard   0.126 </span>
<span class="co">#&gt; 18        50 rectangular         3       16     2 rmse    standard   0.128 </span>
<span class="co">#&gt; # … with 2 more variables: n &lt;int&gt;, std_err &lt;dbl&gt;</span></pre></body></html></div>
<p>With this intrinsically nonlinear model there is less reliance on the nonlinear terms created by the recipe.</p>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>A simple R model formula could have been used here, such as <code>log10(Sale_Price) ~ Longitude + Latitude</code>. A recipe is not required.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p><code>tune</code> has default measures of performance that it uses if none are specified. Here the RMSE and R<sup>2</sup> are estimated. This can be changed using the <code>metrics</code> option.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>One of the tuning parameters (<code>weight_func</code>) is categorical and, by default, has 10 unique values. The model used to predict new test parameters is a Gaussian process model, and this can become slow to fit when the number of tuning parameters is large or when a categorical parameter generates many dummy variables. We’ve reduced the number of categories for this parameter to speed things up a bit.<a href="#fnref3" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="tidyverse">
  <p>tune is a part of the <strong>tidymodels</strong> ecosystem, a collection of modeling packages designed with common APIs and a shared philosophy.</p>
</div>

<div class="author">
  <p>
    Developed by Max Kuhn.
    Site built by <a href="https://pkgdown.r-lib.org">pkgdown</a>.
  </p>
</div>

      </footer>
</div>

  


  </body>
</html>
