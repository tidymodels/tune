<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Optimizations and parallel processing • tune</title>
<script src="../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../../deps/Source_Sans_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../../deps/headroom-0.11.0/headroom.min.js"></script><script src="../../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../../deps/search-1.0.0/fuse.min.js"></script><script src="../../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../../pkgdown.js"></script><meta property="og:title" content="Optimizations and parallel processing">
<meta name="description" content="How can we evaluate candidate models in the shortest amount of time?
">
<meta property="og:description" content="How can we evaluate candidate models in the shortest amount of time?
">
<meta property="og:image" content="https://tune.tidymodels.org/logo.png">
<meta name="robots" content="noindex">
<script src="https://cdn.jsdelivr.net/gh/posit-dev/supported-by-posit/js/badge.min.js" data-max-height="43" data-hide-below="1200" data-light-bg="#666f76" data-light-fg="#f9f9f9"></script><script defer data-domain="tune.tidymodels.org,all.tidymodels.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../../index.html">tune</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">2.0.1.9001</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../../articles/tune.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../../articles/acquisition_functions.html">Acquisition functions</a></li>
    <li><a class="dropdown-item" href="../../articles/extras/optimizations.html">Optimizations and parallel processing</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-learn-more" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Learn more</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-learn-more">
<li><a class="external-link dropdown-item" href="https://www.tidymodels.org/learn/work/tune-svm/">Grid search</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidymodels.org/learn/work/bayes-opt/">Bayesian optimization of classification model</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidymodels.org/learn/work/tune-text/">Tuning text models</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tidymodels/tune/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article" id="container">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../../logo.png" class="logo" alt=""><h1>Optimizations and parallel processing</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tidymodels/tune/blob/main/vignettes/extras/optimizations.Rmd" class="external-link"><code>vignettes/extras/optimizations.Rmd</code></a></small>
      <div class="d-none name"><code>optimizations.Rmd</code></div>
    </div>

    
    
<p>The tune package attempts to evaluate the candidate models in the
shortest amount of time. This vignette is a summary of those
approaches.</p>
<div class="section level2">
<h2 id="sub-model-speed-ups">Sub-model speed-ups<a class="anchor" aria-label="anchor" href="#sub-model-speed-ups"></a>
</h2>
<p>For some types of models, such as boosted models or regularized
models, the number of models that are actually <em>fit</em> can be far
less than the number of models evaluated. For example, suppose a boosted
tree is fit with 1000 trees. Many boosting implementations let the user
make predictions for any number of trees less than what was originally
fit (1000 in this example). This “sub-model trick” can greatly speed up
the training time for many models (e.g. see <a href="https://topepo.github.io/caret/using-your-own-model-in-train.html#illustrative-example-2-something-more-complicated---logitboost" class="external-link">this
example</a> in the <code>caret</code> documentation).</p>
<p>In order to know what models allow this, the parsnip package contains
a <code><a href="https://parsnip.tidymodels.org/reference/multi_predict.html" class="external-link">multi_predict()</a></code> function that enables this feature.
Printing the S3 methods for it lists the possible models:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org" class="external-link">tidymodels</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/methods.html" class="external-link">methods</a></span><span class="op">(</span><span class="st">"multi_predict"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] multi_predict._C5.0*        multi_predict._earth*      </span></span>
<span><span class="co">##  [3] multi_predict._elnet*       multi_predict._glmnetfit*  </span></span>
<span><span class="co">##  [5] multi_predict._lognet*      multi_predict._multnet*    </span></span>
<span><span class="co">##  [7] multi_predict._torch_mlp*   multi_predict._train.kknn* </span></span>
<span><span class="co">##  [9] multi_predict._xgb.Booster* multi_predict.default*     </span></span>
<span><span class="co">## see '?methods' for accessing help and source code</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># There are arguments for the parameter(s) that can create multiple predictions.</span></span>
<span><span class="co"># For xgboost, `trees` are cheap to evaluate: </span></span>
<span><span class="fu">parsnip</span><span class="fu">:::</span><span class="va"><a href="https://parsnip.tidymodels.org/reference/multi_predict.html" class="external-link">multi_predict._xgb.Booster</a></span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/formals.html" class="external-link">formals</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "object"   "new_data" "type"     "trees"    "..."</span></span></code></pre>
<p>The same feature does not exist for recipes though.</p>
</div>
<div class="section level2">
<h2 id="expensive-pre-processing">Expensive pre-processing<a class="anchor" aria-label="anchor" href="#expensive-pre-processing"></a>
</h2>
<p>When tuning a recipe and a model, it makes sense to avoid
<em>recreating</em> the recipe for each model.</p>
<p>For example, suppose that <a href="https://en.wikipedia.org/wiki/Isomap" class="external-link">Isomap multi-dimensional
scaling</a> is used to pre-process the data prior to tuning a K-nearest
neighbor regression:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Chicago</span><span class="op">)</span></span>
<span><span class="va">iso_rec</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html" class="external-link">recipe</a></span><span class="op">(</span><span class="va">ridership</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">Chicago</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_dummy.html" class="external-link">step_dummy</a></span><span class="op">(</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html" class="external-link">all_nominal</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_isomap.html" class="external-link">step_isomap</a></span><span class="op">(</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html" class="external-link">all_predictors</a></span><span class="op">(</span><span class="op">)</span>, num_terms <span class="op">=</span> <span class="fu"><a href="https://hardhat.tidymodels.org/reference/tune.html" class="external-link">tune</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 3 packages (<span style="color: #0000BB;">dimRed</span>, <span style="color: #0000BB;">RSpectra</span>, and <span style="color: #0000BB;">RANN</span>) are needed for this step but</span></span>
<span><span class="co">## are not installed.</span></span></code></pre>
<pre><code><span><span class="co">## To install run: `install.packages(c("dimRed", "RSpectra", "RANN"))`</span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">knn_mod</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/nearest_neighbor.html" class="external-link">nearest_neighbor</a></span><span class="op">(</span>neighbors <span class="op">=</span> <span class="fu"><a href="https://hardhat.tidymodels.org/reference/tune.html" class="external-link">tune</a></span><span class="op">(</span><span class="op">)</span>, weight_func <span class="op">=</span> <span class="fu"><a href="https://hardhat.tidymodels.org/reference/tune.html" class="external-link">tune</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html" class="external-link">set_engine</a></span><span class="op">(</span><span class="st">"kknn"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_args.html" class="external-link">set_mode</a></span><span class="op">(</span><span class="st">"regression"</span><span class="op">)</span></span></code></pre></div>
<p>With the following grid:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grid</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://dials.tidymodels.org/reference/parameters.html" class="external-link">parameters</a></span><span class="op">(</span><span class="fu"><a href="https://dials.tidymodels.org/reference/num_comp.html" class="external-link">num_terms</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">9</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://dials.tidymodels.org/reference/neighbors.html" class="external-link">neighbors</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="https://dials.tidymodels.org/reference/weight_func.html" class="external-link">weight_func</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dials.tidymodels.org/reference/grid_regular.html" class="external-link">grid_regular</a></span><span class="op">(</span>levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">7</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">num_terms</span>, <span class="va">neighbors</span>, <span class="va">weight_func</span><span class="op">)</span></span>
<span><span class="va">grid</span> </span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 350 × 3</span></span></span>
<span><span class="co">##    num_terms neighbors weight_func </span></span>
<span><span class="co">##        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>         1         1 biweight    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>         1         1 cos         </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>         1         1 epanechnikov</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>         1         1 inv         </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>         1         1 rectangular </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>         1         1 triangular  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>         1         1 triweight   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>         1         2 biweight    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>         1         2 cos         </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>         1         2 epanechnikov</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 340 more rows</span></span></span></code></pre>
<p>To evaluate these 350 candidate models, we would have to compute the
same recipe 70 times <em>per resample</em>. Since Isomap is expensive,
this is really inefficient.</p>
<p><code><a href="../../reference/tune_grid.html">tune_grid()</a></code> determines when this occurs and fits all 70
candidate models for each unique configuration of the recipe. In
essence, it nests the model parameters inside the unique parameters of
the recipe:</p>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 5 × 2</span></span></span>
<span><span class="co">##   num_terms data             </span></span>
<span><span class="co">##       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>           </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>         1 <span style="color: #949494;">&lt;tibble [70 × 2]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>         3 <span style="color: #949494;">&lt;tibble [70 × 2]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>         5 <span style="color: #949494;">&lt;tibble [70 × 2]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span>         7 <span style="color: #949494;">&lt;tibble [70 × 2]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span>         9 <span style="color: #949494;">&lt;tibble [70 × 2]&gt;</span></span></span></code></pre>
<p>When <code>parallel_over = "resamples"</code>, the default, only 5
recipes are prepared and, within each, all of the appropriate models are
fit from the same recipe. In this example, once the recipe with
<code>num_terms = 1</code> is created, the model parameters are
iteratively tuned:</p>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 70 × 2</span></span></span>
<span><span class="co">##    neighbors weight_func </span></span>
<span><span class="co">##        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>         1 biweight    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>         1 cos         </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>         1 epanechnikov</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>         1 inv         </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>         1 rectangular </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>         1 triangular  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>         1 triweight   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>         2 biweight    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>         2 cos         </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>         2 epanechnikov</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 60 more rows</span></span></span></code></pre>
<p>The same will be true for post-processing parameters being tuned. For
each unique set of recipe and model parameters, the post-processing
parameters will be evaluated without unnecessary re-fitting.</p>
<p>Also, when using a model formula, the model matrix is only created
once per resample.</p>
</div>
<div class="section level2">
<h2 id="parallel-processing">Parallel processing<a class="anchor" aria-label="anchor" href="#parallel-processing"></a>
</h2>
<p>The tune package allows users, when possible, to use multiple cores
or separate machines to fit models. The package is currently able to
parallelize over either the resampling loop of grid search (via
<code>parallel_over = "resamples"</code> in <code><a href="../../reference/control_grid.html">control_grid()</a></code>,
the default) or both the resampling and preprocessing loops (via
<code>parallel_over = "everything"</code>). When
<code>parallel_over = "everything"</code>, an outer parallel loop will
iterate over resamples and an inner parallel loop will iterate over all
unique combinations of preprocessor and model tuning parameters for that
specific resample. This will result in the preprocessor being
re-processed multiple times, but can be faster if that preprocessing is
extremely fast.</p>
<p>tune supports parallel processing using the <a href="https://www.futureverse.org/" class="external-link">future</a> and <a href="https://mirai.r-lib.org/" class="external-link">mirai</a> frameworks. future supports a
variety of technologies to share the computations and the choice of
technology is determined by the chosen <em>plan</em>. To run tuning code
in parallel, just provide a <code><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan()</a></code> and tune will take care
of the rest. For example:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org" class="external-link">future</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="st">"multisession"</span><span class="op">)</span></span></code></pre></div>
<p>For mirai, you can set the number of worker processes via</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mirai.r-lib.org" class="external-link">mirai</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://mirai.r-lib.org/reference/daemons.html" class="external-link">daemons</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<p>For either parallel frameworks, you don’t have to change your
tidymodels code.</p>
<div class="section level3">
<h3 id="foreach-legacy">foreach (legacy)<a class="anchor" aria-label="anchor" href="#foreach-legacy"></a>
</h3>
<p>Before the 1.2.0 release, tune supported parallelism using the
foreach framework. Support has been deprecated for backends registered
for foreach and will be fully removed in an upcoming release. foreach
can use a variety of technologies to share the computations and the
choice of technology is determined by which <em>parallel backend</em>
package is chosen (aka the <code>do{technology}</code> packages). For
example, the doMC package uses the forking mechanism on Unix-like
systems to split the computations across multiple cores. As of this
writing, the backend packages are doMC, doMPI, doParallel, doRedis,
doSNOW, and doAzureParallel (GitHub only).</p>
<p>Registering a parallel backend is also somewhat dependent of the
package. For doParallel, one could use:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">all_cores</span> <span class="op">&lt;-</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a></span><span class="op">(</span>logical <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RevolutionAnalytics/doparallel" class="external-link">doParallel</a></span><span class="op">)</span></span>
<span><span class="va">cl</span> <span class="op">&lt;-</span> <span class="fu">makePSOCKcluster</span><span class="op">(</span><span class="va">all_cores</span><span class="op">)</span></span>
<span><span class="fu">registerDoParallel</span><span class="op">(</span><span class="va">cl</span><span class="op">)</span></span></code></pre></div>
<p>To <strong>transition from foreach to future</strong>, remove lines
loading any foreach backend packages <code>library(do*)</code> as well
as lines registering that technology with <code>registerDo*()</code>,
and add the following lines:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org" class="external-link">future</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">multisession</span><span class="op">)</span></span></code></pre></div>
<p>Switch out <code>multisession</code> for another strategy if
desired.</p>
</div>
<div class="section level3">
<h3 id="in-practice">In practice<a class="anchor" aria-label="anchor" href="#in-practice"></a>
</h3>
<p>One downside to parallel processing is that the different
technologies handle inputs and outputs differently. For example,
multicore forking <em>tends</em> to carry the loaded packages and
objects into the worker processes. Others do not. To make sure that the
correct packages are loaded (but not attached) in the workers is to use
the <code>pkg</code> option in <code><a href="../../reference/control_grid.html">control_grid()</a></code>.</p>
<p>Some helpful advice to avoid errors in parallel processing is to not
use variables in the global environment. These may not be found when the
code is run inside of a worker process. For example:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">num_pcs</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span></span>
<span><span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html" class="external-link">recipe</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># Bad since num_pcs might not be found by a worker process</span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_pca.html" class="external-link">step_pca</a></span><span class="op">(</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html" class="external-link">all_predictors</a></span><span class="op">(</span><span class="op">)</span>, num_comp <span class="op">=</span> <span class="va">num_pcs</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html" class="external-link">recipe</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># Good since the value is injected into the object</span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_pca.html" class="external-link">step_pca</a></span><span class="op">(</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html" class="external-link">all_predictors</a></span><span class="op">(</span><span class="op">)</span>, num_comp <span class="op">=</span> <span class="op">!</span><span class="op">!</span><span class="va">num_pcs</span><span class="op">)</span></span></code></pre></div>
<p>This issue is likely to occur if <code><a href="https://tidyselect.r-lib.org/reference/one_of.html" class="external-link">dplyr::one_of()</a></code> is used
as a sector.</p>
<p>Also note that almost all of the logging provided by
<code><a href="../../reference/tune_grid.html">tune_grid()</a></code> will not be seen when running in parallel.
Again, this is dependent on the backend package and technology being
used.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/topepo" class="external-link">Max Kuhn</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

  </div></footer>
</body>
</html>
