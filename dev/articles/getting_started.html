<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Getting Started with tune • tune</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="../tidyverse.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../tidyverse-2.css" rel="stylesheet">
<!--optional theme--><link href="../tidymodels.css" rel="stylesheet">
<meta property="og:title" content="Getting Started with tune">
<meta property="og:description" content="tune">
<meta property="og:image" content="https://tune.tidymodels.org/logo.png">
<meta name="twitter:card" content="summary">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-115082821-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../index.html">tune</a>
        <div class="info hidden-xs hidden-sm">
          <span class="partof">part of <a href="https://tidymodels.org">tidymodels</a></span>
          <span class="version version-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.1.4.9000</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../articles/getting_started.html">Getting Started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://www.tidymodels.org/learn/work/tune-svm/">Grid Search</a>
    </li>
    <li>
      <a href="../articles/acquisition_functions.html">Acquisition Functions</a>
    </li>
    <li>
      <a href="https://www.tidymodels.org/learn/work/bayes-opt/">Bayesian Optimization of Classification Model</a>
    </li>
    <li>
      <a href="../articles/extras/optimizations.html">Optimizations and Parallel Processing</a>
    </li>
    <li>
      <a href="https://www.tidymodels.org/learn/work/tune-text/">Text Analysis Example</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
        <li>
  <a href="https://github.com/tidymodels/tune/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="getting_started_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Getting Started with tune</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tidymodels/tune/blob/master/vignettes/getting_started.Rmd"><code>vignettes/getting_started.Rmd</code></a></small>
      <div class="hidden name"><code>getting_started.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>The <code>tune</code> package helps optimize the modeling process. Users can <em>tag</em> arguments in recipes and model objects for optimization. The search routines in <code>tune</code> can discover these arguments and evaluate candidate values until a combination with good performance is found.</p>
<p>As an example, let’s model the Ames housing data:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org">tidymodels</a></span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">ames</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">4595</span><span class="op">)</span>
<span class="va">data_split</span> <span class="op">&lt;-</span> <span class="va">ames</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Sale_Price <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">Sale_Price</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html">initial_split</a></span><span class="op">(</span>strata <span class="op">=</span> <span class="va">Sale_Price</span><span class="op">)</span>
<span class="va">ames_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html">training</a></span><span class="op">(</span><span class="va">data_split</span><span class="op">)</span>
<span class="va">ames_test</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html">testing</a></span><span class="op">(</span><span class="va">data_split</span><span class="op">)</span></code></pre></div>
<p>For simplicity, the sale price of a house will be modeled as a function of its geo-location. These predictors appear to have nonlinear relationships with the outcome:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ames_train</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Sale_Price</span>, <span class="va">Longitude</span>, <span class="va">Latitude</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Longitude</span>, <span class="va">Latitude</span><span class="op">)</span>, 
                      names_to <span class="op">=</span> <span class="st">"predictor"</span>, values_to <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span>, <span class="va">Sale_Price</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.2</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>se <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">predictor</span>, scales <span class="op">=</span> <span class="st">"free_x"</span><span class="op">)</span>
<span class="co">#&gt; `geom_smooth()` using method = 'gam' and formula 'y ~ s(x, bs = "cs")'</span></code></pre></div>
<p><img src="getting_started_files/figure-html/geo-plots-1.png" width="768"></p>
<p>These two predictors could be modeled using <a href="https://towardsdatascience.com/numerical-interpolation-natural-cubic-spline-52c1157b98ac">natural splines</a> in conjunction with a linear model. The amount of “wiggliness” in these splines is determined by the degrees of freedom. An appropriate value of this parameter cannot be analytically determined from the data, so it is a <em>tuning parameter</em> (a.k.a. a hyper-parameter). A common approach is to use resampling to estimate model performance over different values of these parameters and use these results to set reasonable values.</p>
<p>We can tag these parameters for optimization using the <code><a href="../reference/tune.html">tune()</a></code> function:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ames_rec</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html">recipe</a></span><span class="op">(</span><span class="va">Sale_Price</span> <span class="op">~</span> <span class="va">Gr_Liv_Area</span> <span class="op">+</span> <span class="va">Longitude</span> <span class="op">+</span> <span class="va">Latitude</span>, data <span class="op">=</span> <span class="va">ames_train</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_log.html">step_log</a></span><span class="op">(</span><span class="va">Gr_Liv_Area</span>, base <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_ns.html">step_ns</a></span><span class="op">(</span><span class="va">Longitude</span>, <span class="va">Latitude</span>, deg_free <span class="op">=</span> <span class="fu"><a href="../reference/tune.html">tune</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The package can detect these values and optimize them.</p>
<p>However, based on the plot above, the potential <em>amount</em> of non-linearity between the sale price and the predictors might be different. For example, longitude might require more flexibility than latitude. The recipe above would constrain the nonlinearity of the predictors to be the same. We can probably do better than that.</p>
<p>To accomplish this, individual <code><a href="https://recipes.tidymodels.org/reference/step_ns.html">step_ns()</a></code> terms can be added to the recipe for each predictor. However, we want these to be identifiable; using the same syntax as above, we can’t tell the difference between the two <code>deg_free</code> parameters.</p>
<p><code><a href="../reference/tune.html">tune()</a></code> has an option to provide a text annotation so that each tuning parameter has a unique identifier:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ames_rec</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html">recipe</a></span><span class="op">(</span><span class="va">Sale_Price</span> <span class="op">~</span> <span class="va">Gr_Liv_Area</span> <span class="op">+</span> <span class="va">Longitude</span> <span class="op">+</span> <span class="va">Latitude</span>, data <span class="op">=</span> <span class="va">ames_train</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_log.html">step_log</a></span><span class="op">(</span><span class="va">Gr_Liv_Area</span>, base <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_ns.html">step_ns</a></span><span class="op">(</span><span class="va">Longitude</span>, deg_free <span class="op">=</span> <span class="fu"><a href="../reference/tune.html">tune</a></span><span class="op">(</span><span class="st">"long df"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_ns.html">step_ns</a></span><span class="op">(</span><span class="va">Latitude</span>,  deg_free <span class="op">=</span> <span class="fu"><a href="../reference/tune.html">tune</a></span><span class="op">(</span><span class="st">"lat df"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The function <code><a href="https://dials.tidymodels.org/reference/parameters.html">dials::parameters()</a></code> that can detect and collect the parameters that have been flagged for tuning:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dials.tidymodels.org/reference/parameters.html">parameters</a></span><span class="op">(</span><span class="va">ames_rec</span><span class="op">)</span>
<span class="co">#&gt; Collection of 2 parameters for tuning</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  identifier     type    object</span>
<span class="co">#&gt;     long df deg_free nparam[+]</span>
<span class="co">#&gt;      lat df deg_free nparam[+]</span></code></pre></div>
<p>The <code>dials</code> package has default ranges for many parameters. The generic parameter function for <code>deg_free</code> has a fairly small range:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dials.tidymodels.org/reference/deg_free.html">deg_free</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Degrees of Freedom (quantitative)</span>
<span class="co">#&gt; Range: [1, 5]</span></code></pre></div>
<p>but there is a <code>dials</code> function that is more appropriate for splines:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dials.tidymodels.org/reference/degree.html">spline_degree</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Piecewise Polynomial Degree (quantitative)</span>
<span class="co">#&gt; Range: [1, 10]</span></code></pre></div>
<p>The parameter objects can be easily changed using the <code><a href="https://rdrr.io/r/stats/update.html">update()</a></code> function:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ames_param</span> <span class="op">&lt;-</span> 
  <span class="va">ames_rec</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dials.tidymodels.org/reference/parameters.html">parameters</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span>
    `long df` <span class="op">=</span> <span class="fu"><a href="https://dials.tidymodels.org/reference/degree.html">spline_degree</a></span><span class="op">(</span><span class="op">)</span>, 
    `lat df` <span class="op">=</span> <span class="fu"><a href="https://dials.tidymodels.org/reference/degree.html">spline_degree</a></span><span class="op">(</span><span class="op">)</span>
  <span class="op">)</span>
<span class="va">ames_param</span>
<span class="co">#&gt; Collection of 2 parameters for tuning</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  identifier     type    object</span>
<span class="co">#&gt;     long df deg_free nparam[+]</span>
<span class="co">#&gt;      lat df deg_free nparam[+]</span></code></pre></div>
</div>
<div id="grid-search" class="section level2">
<h2 class="hasAnchor">
<a href="#grid-search" class="anchor"></a>Grid Search</h2>
<p>Grid search uses a pre-defined set of candidate parameters and evaluates these using resampling. The basic ingredients are:</p>
<ul>
<li><p>A grid of candidate values to evaluate.</p></li>
<li><p>One or more performance metrics for quantifying how well the model works.</p></li>
<li><p>A resampling scheme that can be used to appropriately measure performance (which could be a simple validation set).</p></li>
</ul>
<p>To make the grid, a data frame is needed with column names matching the “id” column above. There are several <code>dials</code> functions to created grids (named <code>grid_*</code>). For example, a space-filling design can be created by:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">spline_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dials.tidymodels.org/reference/grid_max_entropy.html">grid_max_entropy</a></span><span class="op">(</span><span class="va">ames_param</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>
<span class="va">spline_grid</span>
<span class="co">#&gt; # A tibble: 10 x 2</span>
<span class="co">#&gt;    `long df` `lat df`</span>
<span class="co">#&gt;        &lt;int&gt;    &lt;int&gt;</span>
<span class="co">#&gt;  1         2        9</span>
<span class="co">#&gt;  2         4        6</span>
<span class="co">#&gt;  3         5       10</span>
<span class="co">#&gt;  4         7        4</span>
<span class="co">#&gt;  5         8        1</span>
<span class="co">#&gt;  6         7        7</span>
<span class="co">#&gt;  7        10        6</span>
<span class="co">#&gt;  8         2        4</span>
<span class="co">#&gt;  9         3        1</span>
<span class="co">#&gt; 10         9       10</span></code></pre></div>
<p>Alternately, <code><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid()</a></code> also works to create a regular grid:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">18</span>, by <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="co"># A regular grid:</span>
<span class="va">spline_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span>`long df` <span class="op">=</span> <span class="va">df_vals</span>, `lat df` <span class="op">=</span> <span class="va">df_vals</span><span class="op">)</span></code></pre></div>
<p>Note that a 2-degree-of-freedom model is a simple quadratic fit.</p>
<p>There are two other ingredients that are required before tuning.</p>
<p>First is a model specification. Using <code>parsnip</code>, a basic linear model can be used:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lm_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://parsnip.tidymodels.org/reference/linear_reg.html">linear_reg</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html">set_engine</a></span><span class="op">(</span><span class="st">"lm"</span><span class="op">)</span></code></pre></div>
<p>No tuning parameters here.</p>
<p>As mentioned above, a resampling specification is also needed. The Ames data set are large enough to use simple 10-fold cross-validation:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">2453</span><span class="op">)</span>
<span class="va">cv_splits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rsample.tidymodels.org/reference/vfold_cv.html">vfold_cv</a></span><span class="op">(</span><span class="va">ames_train</span>, v <span class="op">=</span> <span class="fl">10</span>, strata <span class="op">=</span> <span class="va">Sale_Price</span><span class="op">)</span></code></pre></div>
<p>The root mean squared error will be used to measure performance (and this is the default for regression problems).</p>
<p>Using these objects, <code><a href="../reference/tune_grid.html">tune_grid()</a></code> can be used<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ames_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tune_grid.html">tune_grid</a></span><span class="op">(</span><span class="va">lm_mod</span>, <span class="va">ames_rec</span>, resamples <span class="op">=</span> <span class="va">cv_splits</span>, grid <span class="op">=</span> <span class="va">spline_grid</span><span class="op">)</span></code></pre></div>
<p>The object is similar to the <code>rsample</code> object but with one or more extra columns:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ames_res</span>
<span class="co">#&gt; # Tuning results</span>
<span class="co">#&gt; # 10-fold cross-validation using stratification </span>
<span class="co">#&gt; # A tibble: 10 x 4</span>
<span class="co">#&gt;    splits             id     .metrics               .notes              </span>
<span class="co">#&gt;    &lt;list&gt;             &lt;chr&gt;  &lt;list&gt;                 &lt;list&gt;              </span>
<span class="co">#&gt;  1 &lt;split [1978/221]&gt; Fold01 &lt;tibble[,6] [162 × 6]&gt; &lt;tibble[,1] [0 × 1]&gt;</span>
<span class="co">#&gt;  2 &lt;split [1979/220]&gt; Fold02 &lt;tibble[,6] [162 × 6]&gt; &lt;tibble[,1] [0 × 1]&gt;</span>
<span class="co">#&gt;  3 &lt;split [1979/220]&gt; Fold03 &lt;tibble[,6] [162 × 6]&gt; &lt;tibble[,1] [0 × 1]&gt;</span>
<span class="co">#&gt;  4 &lt;split [1979/220]&gt; Fold04 &lt;tibble[,6] [162 × 6]&gt; &lt;tibble[,1] [0 × 1]&gt;</span>
<span class="co">#&gt;  5 &lt;split [1979/220]&gt; Fold05 &lt;tibble[,6] [162 × 6]&gt; &lt;tibble[,1] [0 × 1]&gt;</span>
<span class="co">#&gt;  6 &lt;split [1979/220]&gt; Fold06 &lt;tibble[,6] [162 × 6]&gt; &lt;tibble[,1] [0 × 1]&gt;</span>
<span class="co">#&gt;  7 &lt;split [1979/220]&gt; Fold07 &lt;tibble[,6] [162 × 6]&gt; &lt;tibble[,1] [0 × 1]&gt;</span>
<span class="co">#&gt;  8 &lt;split [1979/220]&gt; Fold08 &lt;tibble[,6] [162 × 6]&gt; &lt;tibble[,1] [0 × 1]&gt;</span>
<span class="co">#&gt;  9 &lt;split [1979/220]&gt; Fold09 &lt;tibble[,6] [162 × 6]&gt; &lt;tibble[,1] [0 × 1]&gt;</span>
<span class="co">#&gt; 10 &lt;split [1981/218]&gt; Fold10 &lt;tibble[,6] [162 × 6]&gt; &lt;tibble[,1] [0 × 1]&gt;</span></code></pre></div>
<p>The <code>.metrics</code> column has all of the holdout performance estimates<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> for each parameter combination:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ames_res</span><span class="op">$</span><span class="va">.metrics</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
<span class="co">#&gt; # A tibble: 162 x 6</span>
<span class="co">#&gt;    `long df` `lat df` .metric .estimator .estimate .config              </span>
<span class="co">#&gt;        &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;                </span>
<span class="co">#&gt;  1         2        2 rmse    standard       0.115 Preprocessor01_Model1</span>
<span class="co">#&gt;  2         2        2 rsq     standard       0.625 Preprocessor01_Model1</span>
<span class="co">#&gt;  3         4        2 rmse    standard       0.115 Preprocessor02_Model1</span>
<span class="co">#&gt;  4         4        2 rsq     standard       0.624 Preprocessor02_Model1</span>
<span class="co">#&gt;  5         6        2 rmse    standard       0.113 Preprocessor03_Model1</span>
<span class="co">#&gt;  6         6        2 rsq     standard       0.633 Preprocessor03_Model1</span>
<span class="co">#&gt;  7         8        2 rmse    standard       0.113 Preprocessor04_Model1</span>
<span class="co">#&gt;  8         8        2 rsq     standard       0.638 Preprocessor04_Model1</span>
<span class="co">#&gt;  9        10        2 rmse    standard       0.113 Preprocessor05_Model1</span>
<span class="co">#&gt; 10        10        2 rsq     standard       0.637 Preprocessor05_Model1</span>
<span class="co">#&gt; # … with 152 more rows</span></code></pre></div>
<p>To get the average metric value for each parameter combination, <code><a href="../reference/collect_predictions.html">collect_metrics()</a></code> can be put to use:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">estimates</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/collect_predictions.html">collect_metrics</a></span><span class="op">(</span><span class="va">ames_res</span><span class="op">)</span>
<span class="va">estimates</span>
<span class="co">#&gt; # A tibble: 162 x 8</span>
<span class="co">#&gt;    `long df` `lat df` .metric .estimator  mean     n std_err .config            </span>
<span class="co">#&gt;        &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;              </span>
<span class="co">#&gt;  1         2        2 rmse    standard   0.102    10 0.00243 Preprocessor01_Mod…</span>
<span class="co">#&gt;  2         2        2 rsq     standard   0.674    10 0.0109  Preprocessor01_Mod…</span>
<span class="co">#&gt;  3         4        2 rmse    standard   0.102    10 0.00242 Preprocessor02_Mod…</span>
<span class="co">#&gt;  4         4        2 rsq     standard   0.675    10 0.0108  Preprocessor02_Mod…</span>
<span class="co">#&gt;  5         6        2 rmse    standard   0.101    10 0.00241 Preprocessor03_Mod…</span>
<span class="co">#&gt;  6         6        2 rsq     standard   0.681    10 0.0105  Preprocessor03_Mod…</span>
<span class="co">#&gt;  7         8        2 rmse    standard   0.100    10 0.00246 Preprocessor04_Mod…</span>
<span class="co">#&gt;  8         8        2 rsq     standard   0.685    10 0.0110  Preprocessor04_Mod…</span>
<span class="co">#&gt;  9        10        2 rmse    standard   0.100    10 0.00243 Preprocessor05_Mod…</span>
<span class="co">#&gt; 10        10        2 rsq     standard   0.685    10 0.0107  Preprocessor05_Mod…</span>
<span class="co">#&gt; # … with 152 more rows</span></code></pre></div>
<p>The values in the <code>mean</code> column are the averages of the 10 resamples. The best RMSE values corresponded to:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rmse_vals</span> <span class="op">&lt;-</span> 
  <span class="va">estimates</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">.metric</span> <span class="op">==</span> <span class="st">"rmse"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">mean</span><span class="op">)</span>
<span class="va">rmse_vals</span>
<span class="co">#&gt; # A tibble: 81 x 8</span>
<span class="co">#&gt;    `long df` `lat df` .metric .estimator   mean     n std_err .config           </span>
<span class="co">#&gt;        &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;             </span>
<span class="co">#&gt;  1        16       12 rmse    standard   0.0961    10 0.00226 Preprocessor53_Mo…</span>
<span class="co">#&gt;  2        16       18 rmse    standard   0.0961    10 0.00228 Preprocessor80_Mo…</span>
<span class="co">#&gt;  3        16        8 rmse    standard   0.0962    10 0.00223 Preprocessor35_Mo…</span>
<span class="co">#&gt;  4        16       10 rmse    standard   0.0962    10 0.00225 Preprocessor44_Mo…</span>
<span class="co">#&gt;  5        18       12 rmse    standard   0.0963    10 0.00234 Preprocessor54_Mo…</span>
<span class="co">#&gt;  6        12       12 rmse    standard   0.0963    10 0.00235 Preprocessor51_Mo…</span>
<span class="co">#&gt;  7        16       16 rmse    standard   0.0963    10 0.00224 Preprocessor71_Mo…</span>
<span class="co">#&gt;  8        18       18 rmse    standard   0.0963    10 0.00235 Preprocessor81_Mo…</span>
<span class="co">#&gt;  9        14       12 rmse    standard   0.0963    10 0.00234 Preprocessor52_Mo…</span>
<span class="co">#&gt; 10        16       14 rmse    standard   0.0963    10 0.00221 Preprocessor62_Mo…</span>
<span class="co">#&gt; # … with 71 more rows</span></code></pre></div>
<p>Smaller degrees of freedom values correspond to more linear functions, but the grid search indicates that more nonlinearity is better. What was the relationship between these two parameters and RMSE?</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">ames_res</span>, metric <span class="op">=</span> <span class="st">"rmse"</span><span class="op">)</span></code></pre></div>
<p><img src="getting_started_files/figure-html/rmse-tile-1.png" width="768"></p>
<p>Interestingly, latitude does <em>not</em> do well with degrees of freedom less than 8. How nonlinear are the optimal degrees of freedom?</p>
<p>Let’s plot these spline functions over the data for booth good and bad values of <code>deg_free</code>:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ames_train</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Sale_Price</span>, <span class="va">Longitude</span>, <span class="va">Latitude</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Longitude</span>, <span class="va">Latitude</span><span class="op">)</span>, 
                      names_to <span class="op">=</span> <span class="st">"predictor"</span>, values_to <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span>, <span class="va">Sale_Price</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.2</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>se <span class="op">=</span> <span class="cn">FALSE</span>, method <span class="op">=</span> <span class="va">lm</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="fu">splines</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/splines/ns.html">ns</a></span><span class="op">(</span><span class="va">x</span>, df <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,  col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>  <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>se <span class="op">=</span> <span class="cn">FALSE</span>, method <span class="op">=</span> <span class="va">lm</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="fu">splines</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/splines/ns.html">ns</a></span><span class="op">(</span><span class="va">x</span>, df <span class="op">=</span> <span class="fl">16</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">predictor</span>, scales <span class="op">=</span> <span class="st">"free_x"</span><span class="op">)</span></code></pre></div>
<p><img src="getting_started_files/figure-html/final-vals-1.png" width="768"></p>
<p>Looking at these plots, the smaller degrees of freedom (red) are clearly under-fitting. Visually, the more complex splines (blue) might indicate that there is overfitting but this would result in poor RMSE values when computed on the hold-out data.</p>
<p>Based on these results, a new recipe would be created with the optimized values (using the entire training set) and this would be combined with a linear model created form the entire training set.</p>
</div>
<div id="model-optimization" class="section level2">
<h2 class="hasAnchor">
<a href="#model-optimization" class="anchor"></a>Model Optimization</h2>
<p>Instead of a linear regression, a nonlinear model might provide good performance. A K-nearest-neighbor fit will also be optimized. For this example, the number of neighbors and the distance weighting function will be optimized:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># requires the kknn package</span>
<span class="va">knn_mod</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/nearest_neighbor.html">nearest_neighbor</a></span><span class="op">(</span>neighbors <span class="op">=</span> <span class="fu"><a href="../reference/tune.html">tune</a></span><span class="op">(</span><span class="op">)</span>, weight_func <span class="op">=</span> <span class="fu"><a href="../reference/tune.html">tune</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html">set_engine</a></span><span class="op">(</span><span class="st">"kknn"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_args.html">set_mode</a></span><span class="op">(</span><span class="st">"regression"</span><span class="op">)</span></code></pre></div>
<p>The easiest approach to optimize the pre-processing and model parameters is to bundle these objects into a <em>workflow</em>:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/workflows">workflows</a></span><span class="op">)</span>
<span class="va">knn_wflow</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://workflows.tidymodels.org//reference/workflow.html">workflow</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://workflows.tidymodels.org//reference/add_model.html">add_model</a></span><span class="op">(</span><span class="va">knn_mod</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://workflows.tidymodels.org//reference/add_recipe.html">add_recipe</a></span><span class="op">(</span><span class="va">ames_rec</span><span class="op">)</span></code></pre></div>
<p>From this, the parameter set can be used to modify the range and values of parameters being optimized<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">knn_param</span> <span class="op">&lt;-</span> 
  <span class="va">knn_wflow</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dials.tidymodels.org/reference/parameters.html">parameters</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span>
    `long df` <span class="op">=</span> <span class="fu"><a href="https://dials.tidymodels.org/reference/degree.html">spline_degree</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">18</span><span class="op">)</span><span class="op">)</span>, 
    `lat df` <span class="op">=</span> <span class="fu"><a href="https://dials.tidymodels.org/reference/degree.html">spline_degree</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">18</span><span class="op">)</span><span class="op">)</span>,
    neighbors <span class="op">=</span> <span class="fu"><a href="https://dials.tidymodels.org/reference/neighbors.html">neighbors</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">50</span><span class="op">)</span><span class="op">)</span>,
    weight_func <span class="op">=</span> <span class="fu"><a href="https://dials.tidymodels.org/reference/weight_func.html">weight_func</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"rectangular"</span>, <span class="st">"inv"</span>, <span class="st">"gaussian"</span>, <span class="st">"triangular"</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<p>This parameter collection can be passed to the grid functions via the <code>param_info</code> arguments.</p>
<p>Instead of using grid search, an iterative method called <a href="http://krasserm.github.io/2018/03/21/bayesian-optimization/">Bayesian optimization</a> can be used. This takes an initial set of results and tries to predict the next tuning parameters to evaluate.</p>
<p>Although no grid is required, the process requires a few additional pieces of information:</p>
<ul>
<li><p>A description of the search space. At a minimum, the would consist of ranges for numeric values and a list of values for categorical tuning parameters.</p></li>
<li><p>An <a href="https://tidymodels.github.io/tune/articles/acquisition_functions.html">acquisition function</a> that helps score potential tuning parameter values.</p></li>
<li><p>A model for analyzing and making predictions of the best tuning parameter values. A Gaussian Process model is typical and used here.</p></li>
</ul>
<p>The code to conduct the search is:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ctrl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/control_bayes.html">control_bayes</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">8154</span><span class="op">)</span>
<span class="va">knn_search</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tune_bayes.html">tune_bayes</a></span><span class="op">(</span><span class="va">knn_wflow</span>, resamples <span class="op">=</span> <span class="va">cv_splits</span>, initial <span class="op">=</span> <span class="fl">5</span>, iter <span class="op">=</span> <span class="fl">20</span>,
                         param_info <span class="op">=</span> <span class="va">knn_param</span>, control <span class="op">=</span> <span class="va">ctrl</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ❯  Generating a set of 5 initial parameter results</span>
<span class="co">#&gt; ✓ Initialization complete</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Optimizing rmse using the expected improvement</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Iteration 1 ─────────────────────────────────────────────────────────────────</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; i Current best:      rmse=0.08684 (@iter 0)</span>
<span class="co">#&gt; i Gaussian process model</span>
<span class="co">#&gt; ! The Gaussian process model is being fit using 7 features but only has 5</span>
<span class="co">#&gt;   data points to do so. This may cause errors or a poor model fit.</span>
<span class="co">#&gt; ✓ Gaussian process model</span>
<span class="co">#&gt; i Generating 4791 candidates</span>
<span class="co">#&gt; i Predicted candidates</span>
<span class="co">#&gt; i neighbors=5, weight_func=triangular, long df=2, lat df=4</span>
<span class="co">#&gt; i Estimating performance</span>
<span class="co">#&gt; ✓ Estimating performance</span>
<span class="co">#&gt; ♥ Newest results:    rmse=0.08485 (+/-0.00208)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Iteration 2 ─────────────────────────────────────────────────────────────────</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; i Current best:      rmse=0.08485 (@iter 1)</span>
<span class="co">#&gt; i Gaussian process model</span>
<span class="co">#&gt; ! The Gaussian process model is being fit using 7 features but only has 6</span>
<span class="co">#&gt;   data points to do so. This may cause errors or a poor model fit.</span>
<span class="co">#&gt; ✓ Gaussian process model</span>
<span class="co">#&gt; i Generating 4762 candidates</span>
<span class="co">#&gt; i Predicted candidates</span>
<span class="co">#&gt; i neighbors=50, weight_func=gaussian, long df=18, lat df=8</span>
<span class="co">#&gt; i Estimating performance</span>
<span class="co">#&gt; ✓ Estimating performance</span>
<span class="co">#&gt; ⓧ Newest results:    rmse=0.09814 (+/-0.00265)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Iteration 3 ─────────────────────────────────────────────────────────────────</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; i Current best:      rmse=0.08485 (@iter 1)</span>
<span class="co">#&gt; i Gaussian process model</span>
<span class="co">#&gt; ! The Gaussian process model is being fit using 7 features but only has 7</span>
<span class="co">#&gt;   data points to do so. This may cause errors or a poor model fit.</span>
<span class="co">#&gt; ✓ Gaussian process model</span>
<span class="co">#&gt; i Generating 4773 candidates</span>
<span class="co">#&gt; i Predicted candidates</span>
<span class="co">#&gt; i neighbors=48, weight_func=rectangular, long df=2, lat df=18</span>
<span class="co">#&gt; i Estimating performance</span>
<span class="co">#&gt; ✓ Estimating performance</span>
<span class="co">#&gt; ⓧ Newest results:    rmse=0.1172 (+/-0.00223)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Iteration 4 ─────────────────────────────────────────────────────────────────</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; i Current best:      rmse=0.08485 (@iter 1)</span>
<span class="co">#&gt; i Gaussian process model</span>
<span class="co">#&gt; ! The Gaussian process model is being fit using 7 features but only has 8</span>
<span class="co">#&gt;   data points to do so. This may cause errors or a poor model fit.</span>
<span class="co">#&gt; ✓ Gaussian process model</span>
<span class="co">#&gt; i Generating 4752 candidates</span>
<span class="co">#&gt; i Predicted candidates</span>
<span class="co">#&gt; i neighbors=11, weight_func=triangular, long df=6, lat df=2</span>
<span class="co">#&gt; i Estimating performance</span>
<span class="co">#&gt; ✓ Estimating performance</span>
<span class="co">#&gt; ♥ Newest results:    rmse=0.08373 (+/-0.00272)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Iteration 5 ─────────────────────────────────────────────────────────────────</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; i Current best:      rmse=0.08373 (@iter 4)</span>
<span class="co">#&gt; i Gaussian process model</span>
<span class="co">#&gt; ✓ Gaussian process model</span>
<span class="co">#&gt; i Generating 4782 candidates</span>
<span class="co">#&gt; i Predicted candidates</span>
<span class="co">#&gt; i neighbors=15, weight_func=triangular, long df=3, lat df=2</span>
<span class="co">#&gt; i Estimating performance</span>
<span class="co">#&gt; ✓ Estimating performance</span>
<span class="co">#&gt; ⓧ Newest results:    rmse=0.08385 (+/-0.00261)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Iteration 6 ─────────────────────────────────────────────────────────────────</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; i Current best:      rmse=0.08373 (@iter 4)</span>
<span class="co">#&gt; i Gaussian process model</span>
<span class="co">#&gt; ✓ Gaussian process model</span>
<span class="co">#&gt; i Generating 4735 candidates</span>
<span class="co">#&gt; i Predicted candidates</span>
<span class="co">#&gt; i neighbors=10, weight_func=gaussian, long df=4, lat df=2</span>
<span class="co">#&gt; i Estimating performance</span>
<span class="co">#&gt; ✓ Estimating performance</span>
<span class="co">#&gt; ⓧ Newest results:    rmse=0.08459 (+/-0.0029)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Iteration 7 ─────────────────────────────────────────────────────────────────</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; i Current best:      rmse=0.08373 (@iter 4)</span>
<span class="co">#&gt; i Gaussian process model</span>
<span class="co">#&gt; ✓ Gaussian process model</span>
<span class="co">#&gt; i Generating 4775 candidates</span>
<span class="co">#&gt; i Predicted candidates</span>
<span class="co">#&gt; i neighbors=13, weight_func=triangular, long df=11, lat df=2</span>
<span class="co">#&gt; i Estimating performance</span>
<span class="co">#&gt; ✓ Estimating performance</span>
<span class="co">#&gt; ⓧ Newest results:    rmse=0.08611 (+/-0.00271)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Iteration 8 ─────────────────────────────────────────────────────────────────</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; i Current best:      rmse=0.08373 (@iter 4)</span>
<span class="co">#&gt; i Gaussian process model</span>
<span class="co">#&gt; ✓ Gaussian process model</span>
<span class="co">#&gt; i Generating 4766 candidates</span>
<span class="co">#&gt; i Predicted candidates</span>
<span class="co">#&gt; i neighbors=16, weight_func=triangular, long df=6, lat df=3</span>
<span class="co">#&gt; i Estimating performance</span>
<span class="co">#&gt; ✓ Estimating performance</span>
<span class="co">#&gt; ♥ Newest results:    rmse=0.08357 (+/-0.00247)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Iteration 9 ─────────────────────────────────────────────────────────────────</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; i Current best:      rmse=0.08357 (@iter 8)</span>
<span class="co">#&gt; i Gaussian process model</span>
<span class="co">#&gt; ✓ Gaussian process model</span>
<span class="co">#&gt; i Generating 4765 candidates</span>
<span class="co">#&gt; i Predicted candidates</span>
<span class="co">#&gt; i neighbors=4, weight_func=rectangular, long df=4, lat df=3</span>
<span class="co">#&gt; i Estimating performance</span>
<span class="co">#&gt; ✓ Estimating performance</span>
<span class="co">#&gt; ⓧ Newest results:    rmse=0.08626 (+/-0.00262)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Iteration 10 ────────────────────────────────────────────────────────────────</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; i Current best:      rmse=0.08357 (@iter 8)</span>
<span class="co">#&gt; i Gaussian process model</span>
<span class="co">#&gt; ✓ Gaussian process model</span>
<span class="co">#&gt; i Generating 4755 candidates</span>
<span class="co">#&gt; i Predicted candidates</span>
<span class="co">#&gt; i neighbors=17, weight_func=triangular, long df=5, lat df=2</span>
<span class="co">#&gt; i Estimating performance</span>
<span class="co">#&gt; ✓ Estimating performance</span>
<span class="co">#&gt; ⓧ Newest results:    rmse=0.08463 (+/-0.00276)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Iteration 11 ────────────────────────────────────────────────────────────────</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; i Current best:      rmse=0.08357 (@iter 8)</span>
<span class="co">#&gt; i Gaussian process model</span>
<span class="co">#&gt; ✓ Gaussian process model</span>
<span class="co">#&gt; i Generating 4776 candidates</span>
<span class="co">#&gt; i Predicted candidates</span>
<span class="co">#&gt; i neighbors=14, weight_func=triangular, long df=6, lat df=4</span>
<span class="co">#&gt; i Estimating performance</span>
<span class="co">#&gt; ✓ Estimating performance</span>
<span class="co">#&gt; ⓧ Newest results:    rmse=0.08361 (+/-0.00226)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Iteration 12 ────────────────────────────────────────────────────────────────</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; i Current best:      rmse=0.08357 (@iter 8)</span>
<span class="co">#&gt; i Gaussian process model</span>
<span class="co">#&gt; ✓ Gaussian process model</span>
<span class="co">#&gt; i Generating 4777 candidates</span>
<span class="co">#&gt; i Predicted candidates</span>
<span class="co">#&gt; i neighbors=16, weight_func=gaussian, long df=7, lat df=3</span>
<span class="co">#&gt; i Estimating performance</span>
<span class="co">#&gt; ✓ Estimating performance</span>
<span class="co">#&gt; ⓧ Newest results:    rmse=0.08534 (+/-0.00247)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Iteration 13 ────────────────────────────────────────────────────────────────</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; i Current best:      rmse=0.08357 (@iter 8)</span>
<span class="co">#&gt; i Gaussian process model</span>
<span class="co">#&gt; ✓ Gaussian process model</span>
<span class="co">#&gt; i Generating 4774 candidates</span>
<span class="co">#&gt; i Predicted candidates</span>
<span class="co">#&gt; i neighbors=11, weight_func=triangular, long df=5, lat df=3</span>
<span class="co">#&gt; i Estimating performance</span>
<span class="co">#&gt; ✓ Estimating performance</span>
<span class="co">#&gt; ♥ Newest results:    rmse=0.08272 (+/-0.00251)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Iteration 14 ────────────────────────────────────────────────────────────────</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; i Current best:      rmse=0.08272 (@iter 13)</span>
<span class="co">#&gt; i Gaussian process model</span>
<span class="co">#&gt; ✓ Gaussian process model</span>
<span class="co">#&gt; i Generating 4774 candidates</span>
<span class="co">#&gt; i Predicted candidates</span>
<span class="co">#&gt; i neighbors=4, weight_func=triangular, long df=16, lat df=18</span>
<span class="co">#&gt; i Estimating performance</span>
<span class="co">#&gt; ✓ Estimating performance</span>
<span class="co">#&gt; ⓧ Newest results:    rmse=0.091 (+/-0.00222)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Iteration 15 ────────────────────────────────────────────────────────────────</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; i Current best:      rmse=0.08272 (@iter 13)</span>
<span class="co">#&gt; i Gaussian process model</span>
<span class="co">#&gt; ✓ Gaussian process model</span>
<span class="co">#&gt; i Generating 4783 candidates</span>
<span class="co">#&gt; i Predicted candidates</span>
<span class="co">#&gt; i neighbors=3, weight_func=rectangular, long df=6, lat df=10</span>
<span class="co">#&gt; i Estimating performance</span>
<span class="co">#&gt; ✓ Estimating performance</span>
<span class="co">#&gt; ⓧ Newest results:    rmse=0.08922 (+/-0.00237)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Iteration 16 ────────────────────────────────────────────────────────────────</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; i Current best:      rmse=0.08272 (@iter 13)</span>
<span class="co">#&gt; i Gaussian process model</span>
<span class="co">#&gt; ✓ Gaussian process model</span>
<span class="co">#&gt; i Generating 4746 candidates</span>
<span class="co">#&gt; i Predicted candidates</span>
<span class="co">#&gt; i neighbors=11, weight_func=triangular, long df=3, lat df=6</span>
<span class="co">#&gt; i Estimating performance</span>
<span class="co">#&gt; ✓ Estimating performance</span>
<span class="co">#&gt; ♥ Newest results:    rmse=0.08272 (+/-0.00226)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Iteration 17 ────────────────────────────────────────────────────────────────</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; i Current best:      rmse=0.08272 (@iter 16)</span>
<span class="co">#&gt; i Gaussian process model</span>
<span class="co">#&gt; ✓ Gaussian process model</span>
<span class="co">#&gt; i Generating 4790 candidates</span>
<span class="co">#&gt; i Predicted candidates</span>
<span class="co">#&gt; i neighbors=10, weight_func=triangular, long df=2, lat df=3</span>
<span class="co">#&gt; i Estimating performance</span>
<span class="co">#&gt; ✓ Estimating performance</span>
<span class="co">#&gt; ⓧ Newest results:    rmse=0.08341 (+/-0.00236)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Iteration 18 ────────────────────────────────────────────────────────────────</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; i Current best:      rmse=0.08272 (@iter 16)</span>
<span class="co">#&gt; i Gaussian process model</span>
<span class="co">#&gt; ✓ Gaussian process model</span>
<span class="co">#&gt; i Generating 4782 candidates</span>
<span class="co">#&gt; i Predicted candidates</span>
<span class="co">#&gt; i neighbors=10, weight_func=triangular, long df=6, lat df=8</span>
<span class="co">#&gt; i Estimating performance</span>
<span class="co">#&gt; ✓ Estimating performance</span>
<span class="co">#&gt; ⓧ Newest results:    rmse=0.08281 (+/-0.00232)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Iteration 19 ────────────────────────────────────────────────────────────────</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; i Current best:      rmse=0.08272 (@iter 16)</span>
<span class="co">#&gt; i Gaussian process model</span>
<span class="co">#&gt; ✓ Gaussian process model</span>
<span class="co">#&gt; i Generating 4771 candidates</span>
<span class="co">#&gt; i Predicted candidates</span>
<span class="co">#&gt; i neighbors=13, weight_func=triangular, long df=4, lat df=7</span>
<span class="co">#&gt; i Estimating performance</span>
<span class="co">#&gt; ✓ Estimating performance</span>
<span class="co">#&gt; ♥ Newest results:    rmse=0.08251 (+/-0.00235)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Iteration 20 ────────────────────────────────────────────────────────────────</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; i Current best:      rmse=0.08251 (@iter 19)</span>
<span class="co">#&gt; i Gaussian process model</span>
<span class="co">#&gt; ✓ Gaussian process model</span>
<span class="co">#&gt; i Generating 4781 candidates</span>
<span class="co">#&gt; i Predicted candidates</span>
<span class="co">#&gt; i neighbors=13, weight_func=triangular, long df=4, lat df=9</span>
<span class="co">#&gt; i Estimating performance</span>
<span class="co">#&gt; ✓ Estimating performance</span>
<span class="co">#&gt; ⓧ Newest results:    rmse=0.08428 (+/-0.00241)</span></code></pre></div>
<p>Visually, the performance gain was:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">knn_search</span>, type <span class="op">=</span> <span class="st">"performance"</span>, metric <span class="op">=</span> <span class="st">"rmse"</span><span class="op">)</span></code></pre></div>
<p><img src="getting_started_files/figure-html/bo-iter-1.png" width="768"></p>
<p>The best results here were:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/collect_predictions.html">collect_metrics</a></span><span class="op">(</span><span class="va">knn_search</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">.metric</span> <span class="op">==</span> <span class="st">"rmse"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">mean</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 25 x 11</span>
<span class="co">#&gt;    neighbors weight_func `long df` `lat df` .metric .estimator   mean     n</span>
<span class="co">#&gt;        &lt;int&gt; &lt;chr&gt;           &lt;int&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;</span>
<span class="co">#&gt;  1        13 triangular          4        7 rmse    standard   0.0825    10</span>
<span class="co">#&gt;  2        11 triangular          3        6 rmse    standard   0.0827    10</span>
<span class="co">#&gt;  3        11 triangular          5        3 rmse    standard   0.0827    10</span>
<span class="co">#&gt;  4        10 triangular          6        8 rmse    standard   0.0828    10</span>
<span class="co">#&gt;  5        10 triangular          2        3 rmse    standard   0.0834    10</span>
<span class="co">#&gt;  6        16 triangular          6        3 rmse    standard   0.0836    10</span>
<span class="co">#&gt;  7        14 triangular          6        4 rmse    standard   0.0836    10</span>
<span class="co">#&gt;  8        11 triangular          6        2 rmse    standard   0.0837    10</span>
<span class="co">#&gt;  9        15 triangular          3        2 rmse    standard   0.0838    10</span>
<span class="co">#&gt; 10        13 triangular          4        9 rmse    standard   0.0843    10</span>
<span class="co">#&gt; # … with 15 more rows, and 3 more variables: std_err &lt;dbl&gt;, .config &lt;chr&gt;,</span>
<span class="co">#&gt; #   .iter &lt;int&gt;</span></code></pre></div>
<p>With this intrinsically nonlinear model there is less reliance on the nonlinear terms created by the recipe.</p>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>A simple R model formula could have been used here, such as <code>Sale_Price ~ log10(Gr_Liv_Area) + Longitude + Latitude</code>. A recipe is not required.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p><code>tune</code> has default measures of performance that it uses if none are specified. Here the RMSE and R<sup>2</sup> are estimated. This can be changed using the <code>metrics</code> option.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>One of the tuning parameters (<code>weight_func</code>) is categorical and, by default, has 10 unique values. The model used to predict new test parameters is a Gaussian process model, and this can become slow to fit when the number of tuning parameters is large or when a categorical parameter generates many dummy variables. We’ve reduced the number of categories for this parameter to speed things up a bit.<a href="#fnref3" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="tidyverse">
  <p>tune is a part of the <strong>tidymodels</strong> ecosystem, a collection of modeling packages designed with common APIs and a shared philosophy.</p>
</div>

<div class="author">
  <p>
    Developed by Max Kuhn.
    Site built by <a href="https://pkgdown.r-lib.org">pkgdown</a>.
  </p>
</div>

      </footer>
</div>

  


  </body>
</html>
