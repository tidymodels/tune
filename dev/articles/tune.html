<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to tune • tune</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.9/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.9/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to tune">
<meta name="description" content="Start here if this is your first time using tune! You will learn about
basic usage, grid search, and model optimization.
">
<meta property="og:description" content="Start here if this is your first time using tune! You will learn about
basic usage, grid search, and model optimization.
">
<meta property="og:image" content="https://tune.tidymodels.org/logo.png">
<meta name="robots" content="noindex">
<script defer data-domain="tune.tidymodels.org,all.tidymodels.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tune</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.2.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/tune.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/acquisition_functions.html">Acquisition functions</a></li>
    <li><a class="dropdown-item" href="../articles/extras/optimizations.html">Optimizations and parallel processing</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-learn-more" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Learn more</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-learn-more">
<li><a class="external-link dropdown-item" href="https://www.tidymodels.org/learn/work/tune-svm/">Grid search</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidymodels.org/learn/work/bayes-opt/">Bayesian optimization of classification model</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidymodels.org/learn/work/tune-text/">Tuning text models</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tidymodels/tune/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article" id="container">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Introduction to tune</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tidymodels/tune/blob/main/vignettes/tune.Rmd" class="external-link"><code>vignettes/tune.Rmd</code></a></small>
      <div class="d-none name"><code>tune.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The tune package helps optimize the modeling process. Users can
<em>tag</em> arguments in recipes and model objects for optimization.
The search routines in tune can discover these arguments and evaluate
candidate values until a combination with good performance is found.</p>
<p>As an example, let’s model the Ames housing data:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org" class="external-link">tidymodels</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">ames</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">4595</span><span class="op">)</span></span>
<span><span class="va">data_split</span> <span class="op">&lt;-</span> <span class="va">ames</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Sale_Price <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">Sale_Price</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html" class="external-link">initial_split</a></span><span class="op">(</span>strata <span class="op">=</span> <span class="va">Sale_Price</span><span class="op">)</span></span>
<span><span class="va">ames_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html" class="external-link">training</a></span><span class="op">(</span><span class="va">data_split</span><span class="op">)</span></span>
<span><span class="va">ames_test</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html" class="external-link">testing</a></span><span class="op">(</span><span class="va">data_split</span><span class="op">)</span></span></code></pre></div>
<p>For simplicity, the sale price of a house will be modeled as a
function of its geo-location. These predictors appear to have nonlinear
relationships with the outcome:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ames_train</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Sale_Price</span>, <span class="va">Longitude</span>, <span class="va">Latitude</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">Longitude</span>, <span class="va">Latitude</span><span class="op">)</span>, </span>
<span>                      names_to <span class="op">=</span> <span class="st">"predictor"</span>, values_to <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span>, <span class="va">Sale_Price</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>se <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">predictor</span>, scales <span class="op">=</span> <span class="st">"free_x"</span><span class="op">)</span></span>
<span><span class="co">#&gt; `geom_smooth()` using method = 'gam' and formula = 'y ~ s(x, bs =</span></span>
<span><span class="co">#&gt; "cs")'</span></span></code></pre></div>
<p><img src="tune_files/figure-html/geo-plots-1.png" alt="A ggplot2 scatterplot. x axes plot the latitude and longitude, in side-by-side facets, and the log sale price is on the y axis. The clouds of points follow highly non-linear trends, traced by a blue trend line." width="768"></p>
<p>These two predictors could be modeled using <a href="https://towardsdatascience.com/numerical-interpolation-natural-cubic-spline-52c1157b98ac" class="external-link">natural
splines</a> in conjunction with a linear model. The amount of
“wiggliness” in these splines is determined by the degrees of freedom.
An appropriate value of this parameter cannot be analytically determined
from the data, so it is a <em>tuning parameter</em> (a.k.a. a
hyper-parameter). A common approach is to use resampling to estimate
model performance over different values of these parameters and use
these results to set reasonable values.</p>
<p>We can tag these parameters for optimization using the
<code><a href="https://hardhat.tidymodels.org/reference/tune.html" class="external-link">tune()</a></code> function:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ames_rec</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html" class="external-link">recipe</a></span><span class="op">(</span><span class="va">Sale_Price</span> <span class="op">~</span> <span class="va">Gr_Liv_Area</span> <span class="op">+</span> <span class="va">Longitude</span> <span class="op">+</span> <span class="va">Latitude</span>, data <span class="op">=</span> <span class="va">ames_train</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_log.html" class="external-link">step_log</a></span><span class="op">(</span><span class="va">Gr_Liv_Area</span>, base <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_spline_natural.html" class="external-link">step_spline_natural</a></span><span class="op">(</span><span class="va">Longitude</span>, <span class="va">Latitude</span>, deg_free <span class="op">=</span> <span class="fu"><a href="https://hardhat.tidymodels.org/reference/tune.html" class="external-link">tune</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The package can detect these parameters and optimize them.</p>
<p>However, based on the plot above, the potential <em>amount</em> of
non-linearity between the sale price and the predictors might be
different. For example, longitude might require more flexibility than
latitude. The recipe above would constrain the nonlinearity of the
predictors to be the same. We can probably do better than that.</p>
<p>To accomplish this, individual <code><a href="https://recipes.tidymodels.org/reference/step_spline_natural.html" class="external-link">step_spline_natural()</a></code>
terms can be added to the recipe for each predictor. However, we want
these to be identifiable; using the same syntax as above, we can’t tell
the difference between the two <code>deg_free</code> parameters.</p>
<p><code><a href="https://hardhat.tidymodels.org/reference/tune.html" class="external-link">tune()</a></code> has an option to provide a text annotation so
that each tuning parameter has a unique identifier:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ames_rec</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html" class="external-link">recipe</a></span><span class="op">(</span><span class="va">Sale_Price</span> <span class="op">~</span> <span class="va">Gr_Liv_Area</span> <span class="op">+</span> <span class="va">Longitude</span> <span class="op">+</span> <span class="va">Latitude</span>, data <span class="op">=</span> <span class="va">ames_train</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_log.html" class="external-link">step_log</a></span><span class="op">(</span><span class="va">Gr_Liv_Area</span>, base <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_spline_natural.html" class="external-link">step_spline_natural</a></span><span class="op">(</span><span class="va">Longitude</span>, deg_free <span class="op">=</span> <span class="fu"><a href="https://hardhat.tidymodels.org/reference/tune.html" class="external-link">tune</a></span><span class="op">(</span><span class="st">"long df"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_spline_natural.html" class="external-link">step_spline_natural</a></span><span class="op">(</span><span class="va">Latitude</span>,  deg_free <span class="op">=</span> <span class="fu"><a href="https://hardhat.tidymodels.org/reference/tune.html" class="external-link">tune</a></span><span class="op">(</span><span class="st">"lat df"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The function <code><a href="https://hardhat.tidymodels.org/reference/hardhat-extract.html" class="external-link">extract_parameter_set_dials()</a></code> can detect
and collect the parameters that have been flagged for tuning.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://hardhat.tidymodels.org/reference/hardhat-extract.html" class="external-link">extract_parameter_set_dials</a></span><span class="op">(</span><span class="va">ames_rec</span><span class="op">)</span></span>
<span><span class="co">#&gt; Collection of 2 parameters for tuning</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  identifier     type    object</span></span>
<span><span class="co">#&gt;     long df deg_free nparam[+]</span></span>
<span><span class="co">#&gt;      lat df deg_free nparam[+]</span></span></code></pre></div>
<p>The dials package has default ranges for many parameters. The generic
parameter function for <code><a href="https://dials.tidymodels.org/reference/deg_free.html" class="external-link">deg_free()</a></code> has a fairly small
range:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dials.tidymodels.org/reference/deg_free.html" class="external-link">deg_free</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Degrees of Freedom (quantitative)</span></span>
<span><span class="co">#&gt; Range: [1, 5]</span></span></code></pre></div>
<p>However, there is a function in dials that is more appropriate for
splines:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dials.tidymodels.org/reference/degree.html" class="external-link">spline_degree</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Spline Degrees of Freedom (quantitative)</span></span>
<span><span class="co">#&gt; Range: [1, 10]</span></span></code></pre></div>
<p>The parameter objects can be easily changed using the
<code><a href="https://rdrr.io/r/stats/update.html" class="external-link">update()</a></code> function:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ames_param</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">ames_rec</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://hardhat.tidymodels.org/reference/hardhat-extract.html" class="external-link">extract_parameter_set_dials</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span></span>
<span>    `long df` <span class="op">=</span> <span class="fu"><a href="https://dials.tidymodels.org/reference/degree.html" class="external-link">spline_degree</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>    `lat df` <span class="op">=</span> <span class="fu"><a href="https://dials.tidymodels.org/reference/degree.html" class="external-link">spline_degree</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">ames_param</span></span>
<span><span class="co">#&gt; Collection of 2 parameters for tuning</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  identifier     type    object</span></span>
<span><span class="co">#&gt;     long df deg_free nparam[+]</span></span>
<span><span class="co">#&gt;      lat df deg_free nparam[+]</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="grid-search">Grid Search<a class="anchor" aria-label="anchor" href="#grid-search"></a>
</h2>
<p>Grid search uses a pre-defined set of candidate parameters and
evaluates these using resampling. The basic ingredients are:</p>
<ul>
<li><p>A grid of candidate values to evaluate.</p></li>
<li><p>One or more performance metrics for quantifying how well the
model works.</p></li>
<li><p>A resampling scheme that can be used to appropriately measure
performance (which could be a simple validation set).</p></li>
</ul>
<p>To make the grid, a data frame is needed with column names matching
the “identifier” column above. There are several functions in dials to
created grids (named <code>grid_*()</code>). For example, a
space-filling design can be created by:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spline_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dials.tidymodels.org/reference/grid_max_entropy.html" class="external-link">grid_max_entropy</a></span><span class="op">(</span><span class="va">ames_param</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: `grid_max_entropy()` was deprecated in dials 1.3.0.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Please use `grid_space_filling()` instead.</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">generated.</span></span></span>
<span><span class="va">spline_grid</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 2</span></span></span>
<span><span class="co">#&gt;    `long df` `lat df`</span></span>
<span><span class="co">#&gt;        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>         6        5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>         7        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>        10        2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>         3        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>         1        9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>         9        6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>         1        4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>         3        7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>         9       10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>         5        9</span></span></code></pre></div>
<p>Alternately, <code><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid()</a></code> also works to create a
regular grid:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">18</span>, by <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co"># A regular grid:</span></span>
<span><span class="va">spline_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>`long df` <span class="op">=</span> <span class="va">df_vals</span>, `lat df` <span class="op">=</span> <span class="va">df_vals</span><span class="op">)</span></span></code></pre></div>
<p>Note that a 2-degree-of-freedom model is a simple quadratic fit.</p>
<p>There are two other ingredients that are required before tuning.</p>
<p>First is a model specification. Using functions in parsnip, a basic
linear model can be used:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lm_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://parsnip.tidymodels.org/reference/linear_reg.html" class="external-link">linear_reg</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html" class="external-link">set_engine</a></span><span class="op">(</span><span class="st">"lm"</span><span class="op">)</span></span></code></pre></div>
<p>No tuning parameters here.</p>
<p>As mentioned above, a resampling specification is also needed. The
Ames data set is large enough to use simple 10-fold
cross-validation:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2453</span><span class="op">)</span></span>
<span><span class="va">cv_splits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rsample.tidymodels.org/reference/vfold_cv.html" class="external-link">vfold_cv</a></span><span class="op">(</span><span class="va">ames_train</span>, v <span class="op">=</span> <span class="fl">10</span>, strata <span class="op">=</span> <span class="va">Sale_Price</span><span class="op">)</span></span></code></pre></div>
<p>The root mean squared error will be used to measure performance (and
this is the default for regression problems).</p>
<p>Using these objects, <code><a href="../reference/tune_grid.html">tune_grid()</a></code> can be used<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;A simple R model formula could have been used here, such
as &lt;code&gt;Sale_Price ~ log10(Gr_Liv_Area) + Longitude + Latitude&lt;/code&gt;.
A recipe is not required.&lt;/p&gt;"><sup>1</sup></a>:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ames_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tune_grid.html">tune_grid</a></span><span class="op">(</span><span class="va">lm_mod</span>, <span class="va">ames_rec</span>, resamples <span class="op">=</span> <span class="va">cv_splits</span>, grid <span class="op">=</span> <span class="va">spline_grid</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: <span style="color: #BBBB00;">!</span> <span style="color: #0000BB;">tune</span> detected a parallel backend registered with foreach but no backend</span></span>
<span><span class="co">#&gt;   registered with future.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Support for parallel processing with foreach was soft-deprecated in</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">tune</span> 1.2.1.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> See ?parallelism (`?tune::parallelism()`) to learn more.</span></span></code></pre></div>
<p>The object is similar to the <code>rsample</code> object but with one
or more extra columns:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ames_res</span></span>
<span><span class="co">#&gt; # Tuning results</span></span>
<span><span class="co">#&gt; # 10-fold cross-validation using stratification </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 4</span></span></span>
<span><span class="co">#&gt;    splits             id     .metrics           .notes          </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> <span style="color: #949494;">&lt;split [1976/221]&gt;</span> Fold01 <span style="color: #949494;">&lt;tibble [162 × 6]&gt;</span> <span style="color: #949494;">&lt;tibble [0 × 4]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> <span style="color: #949494;">&lt;split [1976/221]&gt;</span> Fold02 <span style="color: #949494;">&lt;tibble [162 × 6]&gt;</span> <span style="color: #949494;">&lt;tibble [0 × 4]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> <span style="color: #949494;">&lt;split [1976/221]&gt;</span> Fold03 <span style="color: #949494;">&lt;tibble [162 × 6]&gt;</span> <span style="color: #949494;">&lt;tibble [0 × 4]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> <span style="color: #949494;">&lt;split [1976/221]&gt;</span> Fold04 <span style="color: #949494;">&lt;tibble [162 × 6]&gt;</span> <span style="color: #949494;">&lt;tibble [0 × 4]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> <span style="color: #949494;">&lt;split [1977/220]&gt;</span> Fold05 <span style="color: #949494;">&lt;tibble [162 × 6]&gt;</span> <span style="color: #949494;">&lt;tibble [0 × 4]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> <span style="color: #949494;">&lt;split [1977/220]&gt;</span> Fold06 <span style="color: #949494;">&lt;tibble [162 × 6]&gt;</span> <span style="color: #949494;">&lt;tibble [0 × 4]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> <span style="color: #949494;">&lt;split [1978/219]&gt;</span> Fold07 <span style="color: #949494;">&lt;tibble [162 × 6]&gt;</span> <span style="color: #949494;">&lt;tibble [0 × 4]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> <span style="color: #949494;">&lt;split [1978/219]&gt;</span> Fold08 <span style="color: #949494;">&lt;tibble [162 × 6]&gt;</span> <span style="color: #949494;">&lt;tibble [0 × 4]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> <span style="color: #949494;">&lt;split [1979/218]&gt;</span> Fold09 <span style="color: #949494;">&lt;tibble [162 × 6]&gt;</span> <span style="color: #949494;">&lt;tibble [0 × 4]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> <span style="color: #949494;">&lt;split [1980/217]&gt;</span> Fold10 <span style="color: #949494;">&lt;tibble [162 × 6]&gt;</span> <span style="color: #949494;">&lt;tibble [0 × 4]&gt;</span></span></span></code></pre></div>
<p>The <code>.metrics</code> column has all of the holdout performance
estimates<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;the tune package has default measures of performance
that it uses if none are specified. Here the RMSE and R&lt;sup&gt;2&lt;/sup&gt; are
estimated. This can be changed using the &lt;code&gt;metrics&lt;/code&gt; option.&lt;/p&gt;"><sup>2</sup></a> for each parameter combination:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ames_res</span><span class="op">$</span><span class="va">.metrics</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 162 × 6</span></span></span>
<span><span class="co">#&gt;    `long df` `lat df` .metric .estimator .estimate .config              </span></span>
<span><span class="co">#&gt;        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>         2        2 rmse    standard      0.098<span style="text-decoration: underline;">0</span> Preprocessor01_Model1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>         2        2 rsq     standard      0.686  Preprocessor01_Model1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>         4        2 rmse    standard      0.097<span style="text-decoration: underline;">9</span> Preprocessor02_Model1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>         4        2 rsq     standard      0.687  Preprocessor02_Model1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>         6        2 rmse    standard      0.096<span style="text-decoration: underline;">6</span> Preprocessor03_Model1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>         6        2 rsq     standard      0.695  Preprocessor03_Model1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>         8        2 rmse    standard      0.095<span style="text-decoration: underline;">6</span> Preprocessor04_Model1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>         8        2 rsq     standard      0.701  Preprocessor04_Model1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>        10        2 rmse    standard      0.095<span style="text-decoration: underline;">4</span> Preprocessor05_Model1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>        10        2 rsq     standard      0.703  Preprocessor05_Model1</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 152 more rows</span></span></span></code></pre></div>
<p>To get the average metric value for each parameter combination,
<code><a href="../reference/collect_predictions.html">collect_metrics()</a></code> can be put to use:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">estimates</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/collect_predictions.html">collect_metrics</a></span><span class="op">(</span><span class="va">ames_res</span><span class="op">)</span></span>
<span><span class="va">estimates</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 162 × 8</span></span></span>
<span><span class="co">#&gt;    `long df` `lat df` .metric .estimator   mean     n std_err .config     </span></span>
<span><span class="co">#&gt;        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>         2        2 rmse    standard   0.099<span style="text-decoration: underline;">8</span>    10 0.001<span style="text-decoration: underline;">40</span> Preprocesso…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>         2        2 rsq     standard   0.678     10 0.007<span style="text-decoration: underline;">37</span> Preprocesso…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>         4        2 rmse    standard   0.099<span style="text-decoration: underline;">6</span>    10 0.001<span style="text-decoration: underline;">49</span> Preprocesso…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>         4        2 rsq     standard   0.680     10 0.007<span style="text-decoration: underline;">72</span> Preprocesso…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>         6        2 rmse    standard   0.098<span style="text-decoration: underline;">7</span>    10 0.001<span style="text-decoration: underline;">55</span> Preprocesso…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>         6        2 rsq     standard   0.685     10 0.008<span style="text-decoration: underline;">32</span> Preprocesso…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>         8        2 rmse    standard   0.098<span style="text-decoration: underline;">3</span>    10 0.001<span style="text-decoration: underline;">55</span> Preprocesso…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>         8        2 rsq     standard   0.687     10 0.008<span style="text-decoration: underline;">98</span> Preprocesso…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>        10        2 rmse    standard   0.098<span style="text-decoration: underline;">5</span>    10 0.001<span style="text-decoration: underline;">62</span> Preprocesso…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>        10        2 rsq     standard   0.686     10 0.009<span style="text-decoration: underline;">65</span> Preprocesso…</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 152 more rows</span></span></span></code></pre></div>
<p>The values in the <code>mean</code> column are the averages of the 10
resamples. The best RMSE values corresponded to:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rmse_vals</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">estimates</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.metric</span> <span class="op">==</span> <span class="st">"rmse"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">mean</span><span class="op">)</span></span>
<span><span class="va">rmse_vals</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 81 × 8</span></span></span>
<span><span class="co">#&gt;    `long df` `lat df` .metric .estimator   mean     n std_err .config     </span></span>
<span><span class="co">#&gt;        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>        16       12 rmse    standard   0.094<span style="text-decoration: underline;">8</span>    10 0.001<span style="text-decoration: underline;">20</span> Preprocesso…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>        18       12 rmse    standard   0.094<span style="text-decoration: underline;">8</span>    10 0.001<span style="text-decoration: underline;">21</span> Preprocesso…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>        16        8 rmse    standard   0.094<span style="text-decoration: underline;">9</span>    10 0.001<span style="text-decoration: underline;">18</span> Preprocesso…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>        16       10 rmse    standard   0.094<span style="text-decoration: underline;">9</span>    10 0.001<span style="text-decoration: underline;">18</span> Preprocesso…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>        16       18 rmse    standard   0.094<span style="text-decoration: underline;">9</span>    10 0.001<span style="text-decoration: underline;">19</span> Preprocesso…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>        16       16 rmse    standard   0.094<span style="text-decoration: underline;">9</span>    10 0.001<span style="text-decoration: underline;">22</span> Preprocesso…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>        18       10 rmse    standard   0.094<span style="text-decoration: underline;">9</span>    10 0.001<span style="text-decoration: underline;">19</span> Preprocesso…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>        18        8 rmse    standard   0.094<span style="text-decoration: underline;">9</span>    10 0.001<span style="text-decoration: underline;">19</span> Preprocesso…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>        18       18 rmse    standard   0.095<span style="text-decoration: underline;">0</span>    10 0.001<span style="text-decoration: underline;">20</span> Preprocesso…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>        16       14 rmse    standard   0.095<span style="text-decoration: underline;">0</span>    10 0.001<span style="text-decoration: underline;">17</span> Preprocesso…</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 71 more rows</span></span></span></code></pre></div>
<p>Smaller degrees of freedom values correspond to more linear
functions, but the grid search indicates that more nonlinearity is
better. What was the relationship between these two parameters and
RMSE?</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">ames_res</span>, metric <span class="op">=</span> <span class="st">"rmse"</span><span class="op">)</span></span></code></pre></div>
<p><img src="tune_files/figure-html/rmse-tile-1.png" alt="A ggplot2 line plot. The x axis plots the degrees of freedom alotted to the spline parameter mapped to the longitude, and ranges from 0 to 17. The y axis plots the root mean squared error. Lines are colored by the spline terms for the latitude. Generally, from left to right, each line follows a downward trend, and lines from higher latitude degrees of freedom and centered lower." width="768"></p>
<p>Interestingly, latitude does <em>not</em> do well with degrees of
freedom less than 8. How nonlinear are the optimal degrees of
freedom?</p>
<p>Let’s plot these spline functions over the data for both good and bad
values of <code>deg_free</code>:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ames_train</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Sale_Price</span>, <span class="va">Longitude</span>, <span class="va">Latitude</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">Longitude</span>, <span class="va">Latitude</span><span class="op">)</span>, </span>
<span>                      names_to <span class="op">=</span> <span class="st">"predictor"</span>, values_to <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span>, <span class="va">Sale_Price</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>se <span class="op">=</span> <span class="cn">FALSE</span>, method <span class="op">=</span> <span class="va">lm</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="fu">splines</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/splines/ns.html" class="external-link">ns</a></span><span class="op">(</span><span class="va">x</span>, df <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,  col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>  <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>se <span class="op">=</span> <span class="cn">FALSE</span>, method <span class="op">=</span> <span class="va">lm</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="fu">splines</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/splines/ns.html" class="external-link">ns</a></span><span class="op">(</span><span class="va">x</span>, df <span class="op">=</span> <span class="fl">16</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">predictor</span>, scales <span class="op">=</span> <span class="st">"free_x"</span><span class="op">)</span></span></code></pre></div>
<p><img src="tune_files/figure-html/final-vals-1.png" alt="A scatterplot much like the first one, except that a smoother, red line, representing a spline term with fewer degrees of freedom, is also plotted. The red line is much smoother but accounts for the less of the variation shown." width="768"></p>
<p>Looking at these plots, the smaller degrees of freedom (red) are
clearly under-fitting. Visually, the more complex splines (blue) might
indicate that there is overfitting but this would result in poor RMSE
values when computed on the hold-out data.</p>
<p>Based on these results, a new recipe would be created with the
optimized values (using the entire training set) and this would be
combined with a linear model created form the entire training set.</p>
</div>
<div class="section level2">
<h2 id="model-optimization">Model Optimization<a class="anchor" aria-label="anchor" href="#model-optimization"></a>
</h2>
<p>Instead of a linear regression, a nonlinear model might provide good
performance. A K-nearest-neighbor fit will also be optimized. For this
example, the number of neighbors and the distance weighting function
will be optimized:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># requires the kknn package</span></span>
<span><span class="va">knn_mod</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/nearest_neighbor.html" class="external-link">nearest_neighbor</a></span><span class="op">(</span>neighbors <span class="op">=</span> <span class="fu"><a href="https://hardhat.tidymodels.org/reference/tune.html" class="external-link">tune</a></span><span class="op">(</span><span class="op">)</span>, weight_func <span class="op">=</span> <span class="fu"><a href="https://hardhat.tidymodels.org/reference/tune.html" class="external-link">tune</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html" class="external-link">set_engine</a></span><span class="op">(</span><span class="st">"kknn"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_args.html" class="external-link">set_mode</a></span><span class="op">(</span><span class="st">"regression"</span><span class="op">)</span></span></code></pre></div>
<p>The easiest approach to optimize the pre-processing and model
parameters is to bundle these objects into a <em>workflow</em>:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/workflows" class="external-link">workflows</a></span><span class="op">)</span></span>
<span><span class="va">knn_wflow</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://workflows.tidymodels.org/reference/workflow.html" class="external-link">workflow</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://workflows.tidymodels.org/reference/add_model.html" class="external-link">add_model</a></span><span class="op">(</span><span class="va">knn_mod</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://workflows.tidymodels.org/reference/add_recipe.html" class="external-link">add_recipe</a></span><span class="op">(</span><span class="va">ames_rec</span><span class="op">)</span></span></code></pre></div>
<p>From this, the parameter set can be used to modify the range and
values of parameters being optimized<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;One of the tuning parameters (&lt;code&gt;weight_func&lt;/code&gt;)
is categorical and, by default, has 10 unique values. The model used to
predict new test parameters is a Gaussian process model, and this can
become slow to fit when the number of tuning parameters is large or when
a categorical parameter generates many dummy variables. We’ve reduced
the number of categories for this parameter to speed things up a bit.&lt;/p&gt;"><sup>3</sup></a>:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">knn_param</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">knn_wflow</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://hardhat.tidymodels.org/reference/hardhat-extract.html" class="external-link">extract_parameter_set_dials</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span></span>
<span>    `long df` <span class="op">=</span> <span class="fu"><a href="https://dials.tidymodels.org/reference/degree.html" class="external-link">spline_degree</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">18</span><span class="op">)</span><span class="op">)</span>, </span>
<span>    `lat df` <span class="op">=</span> <span class="fu"><a href="https://dials.tidymodels.org/reference/degree.html" class="external-link">spline_degree</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">18</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    neighbors <span class="op">=</span> <span class="fu"><a href="https://dials.tidymodels.org/reference/neighbors.html" class="external-link">neighbors</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">50</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    weight_func <span class="op">=</span> <span class="fu"><a href="https://dials.tidymodels.org/reference/weight_func.html" class="external-link">weight_func</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rectangular"</span>, <span class="st">"inv"</span>, <span class="st">"gaussian"</span>, <span class="st">"triangular"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>This parameter collection can be used with the grid functions or with
<code><a href="../reference/tune_grid.html">tune_grid()</a></code> via the <code>param_info</code> argument.</p>
<p>Instead of using grid search, an iterative method called <a href="http://krasserm.github.io/2018/03/21/bayesian-optimization/" class="external-link">Bayesian
optimization</a> can be used. This takes an initial set of results and
tries to predict the next tuning parameters to evaluate.</p>
<p>Although no grid is required, the process requires a few additional
pieces of information:</p>
<ul>
<li><p>A description of the search space. At a minimum, the would
consist of ranges for numeric values and a list of values for
categorical tuning parameters.</p></li>
<li><p>An <a href="https://tidymodels.github.io/tune/articles/acquisition_functions.html" class="external-link">acquisition
function</a> that helps score potential tuning parameter
values.</p></li>
<li><p>A model for analyzing and making predictions of the best tuning
parameter values. A Gaussian Process model is typical and used
here.</p></li>
</ul>
<p>The code to conduct the search is:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ctrl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/control_bayes.html">control_bayes</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">8154</span><span class="op">)</span></span>
<span><span class="va">knn_search</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tune_bayes.html">tune_bayes</a></span><span class="op">(</span><span class="va">knn_wflow</span>, resamples <span class="op">=</span> <span class="va">cv_splits</span>, initial <span class="op">=</span> <span class="fl">5</span>, iter <span class="op">=</span> <span class="fl">20</span>,</span>
<span>                         param_info <span class="op">=</span> <span class="va">knn_param</span>, control <span class="op">=</span> <span class="va">ctrl</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #000000;">❯</span> <span style="color: #000000;"> Generating a set of 5 initial parameter results</span></span></span>
<span><span class="co">#&gt; Warning: <span style="color: #BBBB00;">!</span> <span style="color: #0000BB;">tune</span> detected a parallel backend registered with foreach but no backend</span></span>
<span><span class="co">#&gt;   registered with future.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Support for parallel processing with foreach was soft-deprecated in</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">tune</span> 1.2.1.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> See ?parallelism (`?tune::parallelism()`) to learn more.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✓</span> <span style="color: #000000;">Initialization complete</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Gaussian process model</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> <span style="color: #BBBB00;">The Gaussian process model is being fit using 7 features but only has</span></span></span>
<span><span class="co">#&gt;   <span style="color: #BBBB00;">5 data points to do so. This may cause errors or a poor model fit.</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✓</span> <span style="color: #000000;">Gaussian process model</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Generating 4774 candidates</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Predicted candidates</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Estimating performance</span></span></span>
<span><span class="co">#&gt; Warning: <span style="color: #BBBB00;">!</span> <span style="color: #0000BB;">tune</span> detected a parallel backend registered with foreach but no backend</span></span>
<span><span class="co">#&gt;   registered with future.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Support for parallel processing with foreach was soft-deprecated in</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">tune</span> 1.2.1.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> See ?parallelism (`?tune::parallelism()`) to learn more.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✓</span> <span style="color: #000000;">Estimating performance</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Gaussian process model</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> <span style="color: #BBBB00;">The Gaussian process model is being fit using 7 features but only has</span></span></span>
<span><span class="co">#&gt;   <span style="color: #BBBB00;">6 data points to do so. This may cause errors or a poor model fit.</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✓</span> <span style="color: #000000;">Gaussian process model</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Generating 4770 candidates</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Predicted candidates</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Estimating performance</span></span></span>
<span><span class="co">#&gt; Warning: <span style="color: #BBBB00;">!</span> <span style="color: #0000BB;">tune</span> detected a parallel backend registered with foreach but no backend</span></span>
<span><span class="co">#&gt;   registered with future.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Support for parallel processing with foreach was soft-deprecated in</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">tune</span> 1.2.1.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> See ?parallelism (`?tune::parallelism()`) to learn more.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✓</span> <span style="color: #000000;">Estimating performance</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Gaussian process model</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> <span style="color: #BBBB00;">The Gaussian process model is being fit using 7 features but only has</span></span></span>
<span><span class="co">#&gt;   <span style="color: #BBBB00;">7 data points to do so. This may cause errors or a poor model fit.</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✓</span> <span style="color: #000000;">Gaussian process model</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Generating 4777 candidates</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Predicted candidates</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Estimating performance</span></span></span>
<span><span class="co">#&gt; Warning: <span style="color: #BBBB00;">!</span> <span style="color: #0000BB;">tune</span> detected a parallel backend registered with foreach but no backend</span></span>
<span><span class="co">#&gt;   registered with future.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Support for parallel processing with foreach was soft-deprecated in</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">tune</span> 1.2.1.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> See ?parallelism (`?tune::parallelism()`) to learn more.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✓</span> <span style="color: #000000;">Estimating performance</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Gaussian process model</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> <span style="color: #BBBB00;">The Gaussian process model is being fit using 7 features but only has</span></span></span>
<span><span class="co">#&gt;   <span style="color: #BBBB00;">8 data points to do so. This may cause errors or a poor model fit.</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✓</span> <span style="color: #000000;">Gaussian process model</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Generating 4766 candidates</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Predicted candidates</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Estimating performance</span></span></span>
<span><span class="co">#&gt; Warning: <span style="color: #BBBB00;">!</span> <span style="color: #0000BB;">tune</span> detected a parallel backend registered with foreach but no backend</span></span>
<span><span class="co">#&gt;   registered with future.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Support for parallel processing with foreach was soft-deprecated in</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">tune</span> 1.2.1.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> See ?parallelism (`?tune::parallelism()`) to learn more.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✓</span> <span style="color: #000000;">Estimating performance</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Gaussian process model</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✓</span> <span style="color: #000000;">Gaussian process model</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Generating 4786 candidates</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Predicted candidates</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Estimating performance</span></span></span>
<span><span class="co">#&gt; Warning: <span style="color: #BBBB00;">!</span> <span style="color: #0000BB;">tune</span> detected a parallel backend registered with foreach but no backend</span></span>
<span><span class="co">#&gt;   registered with future.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Support for parallel processing with foreach was soft-deprecated in</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">tune</span> 1.2.1.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> See ?parallelism (`?tune::parallelism()`) to learn more.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✓</span> <span style="color: #000000;">Estimating performance</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Gaussian process model</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✓</span> <span style="color: #000000;">Gaussian process model</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Generating 4792 candidates</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Predicted candidates</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Estimating performance</span></span></span>
<span><span class="co">#&gt; Warning: <span style="color: #BBBB00;">!</span> <span style="color: #0000BB;">tune</span> detected a parallel backend registered with foreach but no backend</span></span>
<span><span class="co">#&gt;   registered with future.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Support for parallel processing with foreach was soft-deprecated in</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">tune</span> 1.2.1.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> See ?parallelism (`?tune::parallelism()`) to learn more.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✓</span> <span style="color: #000000;">Estimating performance</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Gaussian process model</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✓</span> <span style="color: #000000;">Gaussian process model</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Generating 4776 candidates</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Predicted candidates</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Estimating performance</span></span></span>
<span><span class="co">#&gt; Warning: <span style="color: #BBBB00;">!</span> <span style="color: #0000BB;">tune</span> detected a parallel backend registered with foreach but no backend</span></span>
<span><span class="co">#&gt;   registered with future.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Support for parallel processing with foreach was soft-deprecated in</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">tune</span> 1.2.1.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> See ?parallelism (`?tune::parallelism()`) to learn more.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✓</span> <span style="color: #000000;">Estimating performance</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Gaussian process model</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✓</span> <span style="color: #000000;">Gaussian process model</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Generating 4771 candidates</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Predicted candidates</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Estimating performance</span></span></span>
<span><span class="co">#&gt; Warning: <span style="color: #BBBB00;">!</span> <span style="color: #0000BB;">tune</span> detected a parallel backend registered with foreach but no backend</span></span>
<span><span class="co">#&gt;   registered with future.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Support for parallel processing with foreach was soft-deprecated in</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">tune</span> 1.2.1.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> See ?parallelism (`?tune::parallelism()`) to learn more.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✓</span> <span style="color: #000000;">Estimating performance</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Gaussian process model</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✓</span> <span style="color: #000000;">Gaussian process model</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Generating 4773 candidates</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Predicted candidates</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Estimating performance</span></span></span>
<span><span class="co">#&gt; Warning: <span style="color: #BBBB00;">!</span> <span style="color: #0000BB;">tune</span> detected a parallel backend registered with foreach but no backend</span></span>
<span><span class="co">#&gt;   registered with future.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Support for parallel processing with foreach was soft-deprecated in</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">tune</span> 1.2.1.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> See ?parallelism (`?tune::parallelism()`) to learn more.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✓</span> <span style="color: #000000;">Estimating performance</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Gaussian process model</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✓</span> <span style="color: #000000;">Gaussian process model</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Generating 4744 candidates</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Predicted candidates</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Estimating performance</span></span></span>
<span><span class="co">#&gt; Warning: <span style="color: #BBBB00;">!</span> <span style="color: #0000BB;">tune</span> detected a parallel backend registered with foreach but no backend</span></span>
<span><span class="co">#&gt;   registered with future.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Support for parallel processing with foreach was soft-deprecated in</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">tune</span> 1.2.1.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> See ?parallelism (`?tune::parallelism()`) to learn more.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✓</span> <span style="color: #000000;">Estimating performance</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Gaussian process model</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✓</span> <span style="color: #000000;">Gaussian process model</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Generating 4753 candidates</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Predicted candidates</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Estimating performance</span></span></span>
<span><span class="co">#&gt; Warning: <span style="color: #BBBB00;">!</span> <span style="color: #0000BB;">tune</span> detected a parallel backend registered with foreach but no backend</span></span>
<span><span class="co">#&gt;   registered with future.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Support for parallel processing with foreach was soft-deprecated in</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">tune</span> 1.2.1.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> See ?parallelism (`?tune::parallelism()`) to learn more.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✓</span> <span style="color: #000000;">Estimating performance</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Gaussian process model</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✓</span> <span style="color: #000000;">Gaussian process model</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Generating 4782 candidates</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Predicted candidates</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Estimating performance</span></span></span>
<span><span class="co">#&gt; Warning: <span style="color: #BBBB00;">!</span> <span style="color: #0000BB;">tune</span> detected a parallel backend registered with foreach but no backend</span></span>
<span><span class="co">#&gt;   registered with future.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Support for parallel processing with foreach was soft-deprecated in</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">tune</span> 1.2.1.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> See ?parallelism (`?tune::parallelism()`) to learn more.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✓</span> <span style="color: #000000;">Estimating performance</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Gaussian process model</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✓</span> <span style="color: #000000;">Gaussian process model</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Generating 4789 candidates</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Predicted candidates</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Estimating performance</span></span></span>
<span><span class="co">#&gt; Warning: <span style="color: #BBBB00;">!</span> <span style="color: #0000BB;">tune</span> detected a parallel backend registered with foreach but no backend</span></span>
<span><span class="co">#&gt;   registered with future.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Support for parallel processing with foreach was soft-deprecated in</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">tune</span> 1.2.1.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> See ?parallelism (`?tune::parallelism()`) to learn more.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✓</span> <span style="color: #000000;">Estimating performance</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Gaussian process model</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✓</span> <span style="color: #000000;">Gaussian process model</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Generating 4789 candidates</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Predicted candidates</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Estimating performance</span></span></span>
<span><span class="co">#&gt; Warning: <span style="color: #BBBB00;">!</span> <span style="color: #0000BB;">tune</span> detected a parallel backend registered with foreach but no backend</span></span>
<span><span class="co">#&gt;   registered with future.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Support for parallel processing with foreach was soft-deprecated in</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">tune</span> 1.2.1.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> See ?parallelism (`?tune::parallelism()`) to learn more.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✓</span> <span style="color: #000000;">Estimating performance</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Gaussian process model</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✓</span> <span style="color: #000000;">Gaussian process model</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Generating 4775 candidates</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Predicted candidates</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Estimating performance</span></span></span>
<span><span class="co">#&gt; Warning: <span style="color: #BBBB00;">!</span> <span style="color: #0000BB;">tune</span> detected a parallel backend registered with foreach but no backend</span></span>
<span><span class="co">#&gt;   registered with future.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Support for parallel processing with foreach was soft-deprecated in</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">tune</span> 1.2.1.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> See ?parallelism (`?tune::parallelism()`) to learn more.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✓</span> <span style="color: #000000;">Estimating performance</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Gaussian process model</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✓</span> <span style="color: #000000;">Gaussian process model</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Generating 4763 candidates</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Predicted candidates</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Estimating performance</span></span></span>
<span><span class="co">#&gt; Warning: <span style="color: #BBBB00;">!</span> <span style="color: #0000BB;">tune</span> detected a parallel backend registered with foreach but no backend</span></span>
<span><span class="co">#&gt;   registered with future.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Support for parallel processing with foreach was soft-deprecated in</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">tune</span> 1.2.1.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> See ?parallelism (`?tune::parallelism()`) to learn more.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✓</span> <span style="color: #000000;">Estimating performance</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Gaussian process model</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✓</span> <span style="color: #000000;">Gaussian process model</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Generating 4784 candidates</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Predicted candidates</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Estimating performance</span></span></span>
<span><span class="co">#&gt; Warning: <span style="color: #BBBB00;">!</span> <span style="color: #0000BB;">tune</span> detected a parallel backend registered with foreach but no backend</span></span>
<span><span class="co">#&gt;   registered with future.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Support for parallel processing with foreach was soft-deprecated in</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">tune</span> 1.2.1.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> See ?parallelism (`?tune::parallelism()`) to learn more.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✓</span> <span style="color: #000000;">Estimating performance</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Gaussian process model</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✓</span> <span style="color: #000000;">Gaussian process model</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Generating 4758 candidates</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Predicted candidates</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Estimating performance</span></span></span>
<span><span class="co">#&gt; Warning: <span style="color: #BBBB00;">!</span> <span style="color: #0000BB;">tune</span> detected a parallel backend registered with foreach but no backend</span></span>
<span><span class="co">#&gt;   registered with future.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Support for parallel processing with foreach was soft-deprecated in</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">tune</span> 1.2.1.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> See ?parallelism (`?tune::parallelism()`) to learn more.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✓</span> <span style="color: #000000;">Estimating performance</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> No improvement for 10 iterations; returning current results.</span></span></code></pre></div>
<p>Visually, the performance gain was:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">knn_search</span>, type <span class="op">=</span> <span class="st">"performance"</span>, metric <span class="op">=</span> <span class="st">"rmse"</span><span class="op">)</span></span></code></pre></div>
<p><img src="tune_files/figure-html/bo-iter-1.png" alt="A ggplot2 dot plot. The x axis plots iterations, ranging from 0 to 20, and the y axis plots root mean squared error. After iteration 0, each point has error bars for the metric value. Generally, the error decreases as the iteration increases." width="768"></p>
<p>The best results here were:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/collect_predictions.html">collect_metrics</a></span><span class="op">(</span><span class="va">knn_search</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.metric</span> <span class="op">==</span> <span class="st">"rmse"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">mean</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 23 × 11</span></span></span>
<span><span class="co">#&gt;    neighbors weight_func `long df` `lat df` .metric .estimator   mean</span></span>
<span><span class="co">#&gt;        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>        11 triangular          9        8 rmse    standard   0.082<span style="text-decoration: underline;">1</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>         7 triangular          8        7 rmse    standard   0.082<span style="text-decoration: underline;">3</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>        15 triangular          7        7 rmse    standard   0.082<span style="text-decoration: underline;">4</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>        10 inv                 8        8 rmse    standard   0.082<span style="text-decoration: underline;">6</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>        11 inv                 6        8 rmse    standard   0.082<span style="text-decoration: underline;">7</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>        11 triangular          2        6 rmse    standard   0.083<span style="text-decoration: underline;">0</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>        14 triangular          8        9 rmse    standard   0.083<span style="text-decoration: underline;">2</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>         5 inv                 2        6 rmse    standard   0.083<span style="text-decoration: underline;">6</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>         3 rectangular         6        6 rmse    standard   0.084<span style="text-decoration: underline;">3</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>        29 inv                 7        6 rmse    standard   0.085<span style="text-decoration: underline;">8</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 13 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 4 more variables: n &lt;int&gt;, std_err &lt;dbl&gt;, .config &lt;chr&gt;, .iter &lt;int&gt;</span></span></span></code></pre></div>
<p>With this intrinsically nonlinear model there is less reliance on the
nonlinear terms created by the recipe.</p>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/topepo" class="external-link">Max Kuhn</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

  </div></footer>
</body>
</html>
