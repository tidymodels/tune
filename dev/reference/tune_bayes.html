<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="tune_bayes() uses models to generate new candidate tuning parameter
combinations based on previous results."><title>Bayesian optimization of model parameters. — tune_bayes • tune</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.8/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.8/font.css" rel="stylesheet"><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Bayesian optimization of model parameters. — tune_bayes"><meta property="og:description" content="tune_bayes() uses models to generate new candidate tuning parameter
combinations based on previous results."><meta property="og:image" content="https://tune.tidymodels.org/logo.png"><meta name="robots" content="noindex"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><script defer data-domain="tune.tidymodels.org,all.tidymodels.org" src="https://plausible.io/js/plausible.js"></script></head><body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-none"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">tune</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.1.2.9020</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/tune.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/acquisition_functions.html">Acquisition functions</a>
    <a class="dropdown-item" href="../articles/extras/optimizations.html">Optimizations and parallel processing</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-learn-more">Learn more</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-learn-more">
    <a class="external-link dropdown-item" href="https://www.tidymodels.org/learn/work/tune-svm/">Grid search</a>
    <a class="external-link dropdown-item" href="https://www.tidymodels.org/learn/work/bayes-opt/">Bayesian optimization of classification model</a>
    <a class="external-link dropdown-item" href="https://www.tidymodels.org/learn/work/tune-text/">Tuning text models</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/tidymodels/tune/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Bayesian optimization of model parameters.</h1>
      <small class="dont-index">Source: <a href="https://github.com/tidymodels/tune/blob/HEAD/R/tune_bayes.R" class="external-link"><code>R/tune_bayes.R</code></a></small>
      <div class="d-none name"><code>tune_bayes.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>tune_bayes()</code> uses models to generate new candidate tuning parameter
combinations based on previous results.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">tune_bayes</span><span class="op">(</span><span class="va">object</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for model_spec</span></span>
<span><span class="fu">tune_bayes</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  <span class="va">preprocessor</span>,</span>
<span>  <span class="va">resamples</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  iter <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  param_info <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  metrics <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  objective <span class="op">=</span> <span class="fu"><a href="prob_improve.html">exp_improve</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  initial <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="control_bayes.html">control_bayes</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  eval_time <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for workflow</span></span>
<span><span class="fu">tune_bayes</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  <span class="va">resamples</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  iter <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  param_info <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  metrics <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  objective <span class="op">=</span> <span class="fu"><a href="prob_improve.html">exp_improve</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  initial <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="control_bayes.html">control_bayes</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  eval_time <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>object</dt>
<dd><p>A <code>parsnip</code> model specification or an unfitted
<a href="https://workflows.tidymodels.org/reference/workflow.html" class="external-link">workflow()</a>. No tuning parameters are allowed; if arguments
have been marked with <a href="https://hardhat.tidymodels.org/reference/tune.html" class="external-link">tune()</a>, their values must be
<a href="finalize_model.html">finalized</a>.</p></dd>


<dt>...</dt>
<dd><p>Options to pass to <code><a href="https://rdrr.io/pkg/GPfit/man/GP_fit.html" class="external-link">GPfit::GP_fit()</a></code> (mostly for the <code>corr</code> argument).</p></dd>


<dt>preprocessor</dt>
<dd><p>A traditional model formula or a recipe created using
<code><a href="https://recipes.tidymodels.org/reference/recipe.html" class="external-link">recipes::recipe()</a></code>.</p></dd>


<dt>resamples</dt>
<dd><p>An <code>rset</code> resampling object created from an <code>rsample</code>
function, such as <code><a href="https://rsample.tidymodels.org/reference/vfold_cv.html" class="external-link">rsample::vfold_cv()</a></code>.</p></dd>


<dt>iter</dt>
<dd><p>The maximum number of search iterations.</p></dd>


<dt>param_info</dt>
<dd><p>A <code><a href="https://dials.tidymodels.org/reference/parameters.html" class="external-link">dials::parameters()</a></code> object or <code>NULL</code>. If none is given,
a parameters set is derived from other arguments. Passing this argument can
be useful when parameter ranges need to be customized.</p></dd>


<dt>metrics</dt>
<dd><p>A <code><a href="https://yardstick.tidymodels.org/reference/metric_set.html" class="external-link">yardstick::metric_set()</a></code>, or <code>NULL</code> to compute a standard
set of metrics. The first metric in <code>metrics</code> is the one that will be optimized.</p></dd>


<dt>objective</dt>
<dd><p>A character string for what metric should be optimized or
an acquisition function object.</p></dd>


<dt>initial</dt>
<dd><p>An initial set of results in a tidy format (as would result
from <code><a href="tune_grid.html">tune_grid()</a></code>) or a positive integer. It is suggested that the number of
initial results be greater than the number of parameters being optimized.</p></dd>


<dt>control</dt>
<dd><p>A control object created by <code><a href="control_bayes.html">control_bayes()</a></code>.</p></dd>


<dt>eval_time</dt>
<dd><p>A numeric vector of time points where dynamic event time
metrics should be computed (e.g. the time-dependent ROC curve, etc). The
values must be non-negative and should probably be no greater than the
largest event time in the training set (See Details below).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A tibble of results that mirror those generated by <code><a href="tune_grid.html">tune_grid()</a></code>.
However, these results contain an <code>.iter</code> column and replicate the <code>rset</code></p>


<p>object multiple times over iterations (at limited additional memory costs).</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The optimization starts with a set of initial results, such as those
generated by <code><a href="tune_grid.html">tune_grid()</a></code>. If none exist, the function will create several
combinations and obtain their performance estimates.</p>
<p>Using one of the performance estimates as the <em>model outcome</em>, a Gaussian
process (GP) model is created where the previous tuning parameter combinations
are used as the predictors.</p>
<p>A large grid of potential hyperparameter combinations is predicted using
the model and scored using an <em>acquisition function</em>. These functions
usually combine the predicted mean and variance of the GP to decide the best
parameter combination to try next. For more information, see the
documentation for <code><a href="prob_improve.html">exp_improve()</a></code> and the corresponding package vignette.</p>
<p>The best combination is evaluated using resampling and the process continues.</p>
    </div>
    <div class="section level2">
    <h2 id="parallel-processing">Parallel Processing<a class="anchor" aria-label="anchor" href="#parallel-processing"></a></h2>
    


<p>The <code>foreach</code> package is used here. To execute the resampling iterations in
parallel, register a parallel backend function. See the documentation for
<code><a href="https://rdrr.io/pkg/foreach/man/foreach.html" class="external-link">foreach::foreach()</a></code> for examples.</p>
<p>For the most part, warnings generated during training are shown as they occur
and are associated with a specific resample when
<code>control_bayes(verbose = TRUE)</code>. They are (usually) not aggregated until the
end of processing.</p>
<p>For Bayesian optimization, parallel processing is used to estimate the
resampled performance values once a new candidate set of values are estimated.</p>
    </div>
    <div class="section level2">
    <h2 id="initial-values">Initial Values<a class="anchor" aria-label="anchor" href="#initial-values"></a></h2>
    


<p>The results of <code><a href="tune_grid.html">tune_grid()</a></code>, or a previous run of <code>tune_bayes()</code> can be used
in the <code>initial</code> argument. <code>initial</code> can also be a positive integer. In this
case, a space-filling design will be used to populate a preliminary set of
results. For good results, the number of initial values should be more than
the number of parameters being optimized.</p>
    </div>
    <div class="section level2">
    <h2 id="parameter-ranges-and-values">Parameter Ranges and Values<a class="anchor" aria-label="anchor" href="#parameter-ranges-and-values"></a></h2>
    


<p>In some cases, the tuning parameter values depend on the dimensions of the
data (they are said to contain <a href="https://dials.tidymodels.org/reference/unknown.html" class="external-link">unknown</a> values). For
example, <code>mtry</code> in random forest models depends on the number of predictors.
In such cases, the unknowns in the tuning parameter object must be determined
beforehand and passed to the function via the <code>param_info</code> argument.
<code><a href="https://dials.tidymodels.org/reference/finalize.html" class="external-link">dials::finalize()</a></code> can be used to derive the data-dependent parameters.
Otherwise, a parameter set can be created via <code><a href="https://dials.tidymodels.org/reference/parameters.html" class="external-link">dials::parameters()</a></code>, and the
<code>dials</code> <code><a href="https://rdrr.io/r/stats/update.html" class="external-link">update()</a></code> function can be used to specify the ranges or values.</p>
    </div>
    <div class="section level2">
    <h2 id="performance-metrics">Performance Metrics<a class="anchor" aria-label="anchor" href="#performance-metrics"></a></h2>
    


<p>To use your own performance metrics, the <code><a href="https://yardstick.tidymodels.org/reference/metric_set.html" class="external-link">yardstick::metric_set()</a></code> function
can be used to pick what should be measured for each model. If multiple
metrics are desired, they can be bundled. For example, to estimate the area
under the ROC curve as well as the sensitivity and specificity (under the
typical probability cutoff of 0.50), the <code>metrics</code> argument could be given:</p>
<div class="sourceCode"><pre><code><span></span>
<span>  <span class="va">metrics</span> <span class="op">=</span> <span class="fu"><a href="https://yardstick.tidymodels.org/reference/metric_set.html" class="external-link">metric_set</a></span><span class="op">(</span><span class="va">roc_auc</span>, <span class="va">sens</span>, <span class="va">spec</span><span class="op">)</span></span></code></pre></div>

<p>Each metric is calculated for each candidate model.</p>
<p>If no metric set is provided, one is created:</p><ul><li><p>For regression models, the root mean squared error and coefficient
of determination are computed.</p></li>
<li><p>For classification, the area under the ROC curve and overall accuracy
are computed.</p></li>
</ul><p>Note that the metrics also determine what type of predictions are estimated
during tuning. For example, in a classification problem, if metrics are used
that are all associated with hard class predictions, the classification
probabilities are not created.</p>
<p>The out-of-sample estimates of these metrics are contained in a list column
called <code>.metrics</code>. This tibble contains a row for each metric and columns
for the value, the estimator type, and so on.</p>
<p><code><a href="collect_predictions.html">collect_metrics()</a></code> can be used for these objects to collapse the results
over the resampled (to obtain the final resampling estimates per tuning
parameter combination).</p>
    </div>
    <div class="section level2">
    <h2 id="obtaining-predictions">Obtaining Predictions<a class="anchor" aria-label="anchor" href="#obtaining-predictions"></a></h2>
    


<p>When <code>control_bayes(save_pred = TRUE)</code>, the output tibble contains a list
column called <code>.predictions</code> that has the out-of-sample predictions for each
parameter combination in the grid and each fold (which can be very large).</p>
<p>The elements of the tibble are tibbles with columns for the tuning
parameters, the row number from the original data object (<code>.row</code>), the
outcome data (with the same name(s) of the original data), and any columns
created by the predictions. For example, for simple regression problems, this
function generates a column called <code>.pred</code> and so on. As noted above, the
prediction columns that are returned are determined by the type of metric(s)
requested.</p>
<p>This list column can be <code>unnested</code> using <code><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">tidyr::unnest()</a></code> or using the
convenience function <code><a href="collect_predictions.html">collect_predictions()</a></code>.</p>
    </div>
    <div class="section level2">
    <h2 id="case-weights">Case Weights<a class="anchor" aria-label="anchor" href="#case-weights"></a></h2>
    

<p>Some models can utilize case weights during training. tidymodels currently
supports two types of case weights: importance weights (doubles) and
frequency weights (integers). Frequency weights are used during model
fitting and evaluation, whereas importance weights are only used during
fitting.</p>
<p>To know if your model is capable of using case weights, create a model spec
and test it using <code><a href="https://parsnip.tidymodels.org/reference/case_weights_allowed.html" class="external-link">parsnip::case_weights_allowed()</a></code>.</p>
<p>To use them, you will need a numeric column in your data set that has been
passed through either <code><a href="https://hardhat.tidymodels.org/reference/importance_weights.html" class="external-link">hardhat:: importance_weights()</a></code> or
<code><a href="https://hardhat.tidymodels.org/reference/frequency_weights.html" class="external-link">hardhat::frequency_weights()</a></code>.</p>
<p>For functions such as <code><a href="fit_resamples.html">fit_resamples()</a></code> and the <code>tune_*()</code> functions, the
model must be contained inside of a <code><a href="https://workflows.tidymodels.org/reference/workflow.html" class="external-link">workflows::workflow()</a></code>. To declare that
case weights are used, invoke <code><a href="https://workflows.tidymodels.org/reference/add_case_weights.html" class="external-link">workflows::add_case_weights()</a></code> with the
corresponding (unquoted) column name.</p>
<p>From there, the packages will appropriately handle the weights during model
fitting and (if appropriate) performance estimation.</p>
    </div>
    <div class="section level2">
    <h2 id="censored-regression-models">Censored Regression Models<a class="anchor" aria-label="anchor" href="#censored-regression-models"></a></h2>
    


<p>Three types of metrics can be used to assess the quality of censored
regression models:</p><ul><li><p>static: the prediction is independent of time.</p></li>
<li><p>dynamic: the prediction is a time-specific probability (e.g., survival
probability) and is measured at one or more particular times.</p></li>
<li><p>integrated: same as the dynamic metric but returns the integral of the
different metrics from each time point.</p></li>
</ul><p>Which metrics are chosen by the user affects how many evaluation times
should be specified. For example:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Needs no `eval_time` value</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">metric_set</span>(concordance_survival)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Needs at least one `eval_time`</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">metric_set</span>(brier_survival)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">metric_set</span>(brier_survival, concordance_survival)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Needs at least two eval_time` values</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">metric_set</span>(brier_survival_integrated, concordance_survival)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">metric_set</span>(brier_survival_integrated, concordance_survival)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">metric_set</span>(brier_survival_integrated, concordance_survival, brier_survival)</span></code></pre><p></p></div>
<p>Values of <code>eval_time</code> should be less than the largest observed event
time in the training data. For many non-parametric models, the results beyond
the largest time corresponding to an event are constant (or <code>NA</code>).</p>
    </div>
    <div class="section level2">
    <h2 id="optimizing-censored-regression-models">Optimizing Censored Regression Models<a class="anchor" aria-label="anchor" href="#optimizing-censored-regression-models"></a></h2>
    


<p>With dynamic performance metrics (e.g. Brier or ROC curves), performance is
calculated for every value of <code>eval_time</code> but the <em>first</em> evaluation time
given by the user (e.g., <code>eval_time[1]</code>) is used to guide the optimization.</p>
    </div>
    <div class="section level2">
    <h2 id="extracting-information">Extracting Information<a class="anchor" aria-label="anchor" href="#extracting-information"></a></h2>
    


<p>The <code>extract</code> control option will result in an additional function to be
returned called <code>.extracts</code>. This is a list column that has tibbles
containing the results of the user's function for each tuning parameter
combination. This can enable returning each model and/or recipe object that
is created during resampling. Note that this could result in a large return
object, depending on what is returned.</p>
<p>The control function contains an option (<code>extract</code>) that can be used to
retain any model or recipe that was created within the resamples. This
argument should be a function with a single argument. The value of the
argument that is given to the function in each resample is a workflow
object (see <code><a href="https://workflows.tidymodels.org/reference/workflow.html" class="external-link">workflows::workflow()</a></code> for more information). Several
helper functions can be used to easily pull out the preprocessing
and/or model information from the workflow, such as
<code><a href="https://workflows.tidymodels.org/reference/extract-workflow.html" class="external-link">extract_preprocessor()</a></code> and
<code><a href="https://workflows.tidymodels.org/reference/extract-workflow.html" class="external-link">extract_fit_parsnip()</a></code>.</p>
<p>As an example, if there is interest in getting each parsnip model fit back,
one could use:</p><div class="sourceCode"><pre><code><span></span>
<span>  <span class="va">extract</span> <span class="op">=</span> <span class="kw">function</span> <span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://hardhat.tidymodels.org/reference/hardhat-extract.html" class="external-link">extract_fit_parsnip</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></code></pre></div>

<p>Note that the function given to the <code>extract</code> argument is evaluated on
every model that is <em>fit</em> (as opposed to every model that is <em>evaluated</em>).
As noted above, in some cases, model predictions can be derived for
sub-models so that, in these cases, not every row in the tuning parameter
grid has a separate R object associated with it.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="control_bayes.html">control_bayes()</a></code>, <code><a href="https://hardhat.tidymodels.org/reference/tune.html" class="external-link">tune()</a></code>, <code><a href="autoplot.tune_results.html">autoplot.tune_results()</a></code>,
<code><a href="show_best.html">show_best()</a></code>, <code><a href="show_best.html">select_best()</a></code>, <code><a href="collect_predictions.html">collect_predictions()</a></code>,
<code><a href="collect_predictions.html">collect_metrics()</a></code>, <code><a href="prob_improve.html">prob_improve()</a></code>, <code><a href="prob_improve.html">exp_improve()</a></code>, <code><a href="prob_improve.html">conf_bound()</a></code>,
<code><a href="fit_resamples.html">fit_resamples()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/recipes" class="external-link">recipes</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rsample.tidymodels.org" class="external-link">rsample</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/parsnip" class="external-link">parsnip</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># define resamples and minimal recipe on mtcars</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">6735</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">folds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rsample.tidymodels.org/reference/vfold_cv.html" class="external-link">vfold_cv</a></span><span class="op">(</span><span class="va">mtcars</span>, v <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">car_rec</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html" class="external-link">recipe</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_normalize.html" class="external-link">step_normalize</a></span><span class="op">(</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html" class="external-link">all_predictors</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># define an svm with parameters to tune</span></span></span>
<span class="r-in"><span><span class="va">svm_mod</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/svm_rbf.html" class="external-link">svm_rbf</a></span><span class="op">(</span>cost <span class="op">=</span> <span class="fu"><a href="https://hardhat.tidymodels.org/reference/tune.html" class="external-link">tune</a></span><span class="op">(</span><span class="op">)</span>, rbf_sigma <span class="op">=</span> <span class="fu"><a href="https://hardhat.tidymodels.org/reference/tune.html" class="external-link">tune</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html" class="external-link">set_engine</a></span><span class="op">(</span><span class="st">"kernlab"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_args.html" class="external-link">set_mode</a></span><span class="op">(</span><span class="st">"regression"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># use a space-filling design with 6 points</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">3254</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">svm_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="tune_grid.html">tune_grid</a></span><span class="op">(</span><span class="va">svm_mod</span>, <span class="va">car_rec</span>, <span class="va">folds</span>, grid <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="show_best.html">show_best</a></span><span class="op">(</span><span class="va">svm_grid</span>, metric <span class="op">=</span> <span class="st">"rmse"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 5 × 8</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       cost    rbf_sigma .metric .estimator  mean     n std_err .config    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> 25.3     0.248        rmse    standard    3.17     5   0.678 Preprocess…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span>  3.88    0.000<span style="text-decoration: underline;">510</span>     rmse    standard    4.07     5   0.727 Preprocess…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">3</span>  0.102   0.000<span style="text-decoration: underline;">005</span>92   rmse    standard    5.96     5   0.970 Preprocess…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">4</span>  0.001<span style="text-decoration: underline;">25</span> 0.000<span style="text-decoration: underline;">138</span>     rmse    standard    5.96     5   0.970 Preprocess…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">5</span>  0.019<span style="text-decoration: underline;">2</span>  0.000<span style="text-decoration: underline;">000</span>042<span style="text-decoration: underline;">7</span> rmse    standard    5.96     5   0.970 Preprocess…</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># use bayesian optimization to evaluate at 6 more points</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">8241</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">svm_bayes</span> <span class="op">&lt;-</span> <span class="fu">tune_bayes</span><span class="op">(</span><span class="va">svm_mod</span>, <span class="va">car_rec</span>, <span class="va">folds</span>, initial <span class="op">=</span> <span class="va">svm_grid</span>, iter <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># note that bayesian optimization evaluated parameterizations</span></span></span>
<span class="r-in"><span><span class="co"># similar to those that previously decreased rmse in svm_grid</span></span></span>
<span class="r-in"><span><span class="fu"><a href="show_best.html">show_best</a></span><span class="op">(</span><span class="va">svm_bayes</span>, metric <span class="op">=</span> <span class="st">"rmse"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 5 × 9</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    cost rbf_sigma .metric .estimator  mean     n std_err .config     .iter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span>  31.5   0.002<span style="text-decoration: underline;">24</span> rmse    standard    2.59     5   0.219 Iter5           5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span>  31.6   0.006<span style="text-decoration: underline;">71</span> rmse    standard    2.61     5   0.208 Iter4           4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">3</span>  32.0   0.001<span style="text-decoration: underline;">09</span> rmse    standard    2.62     5   0.253 Iter1           1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">4</span>  31.6   0.004<span style="text-decoration: underline;">66</span> rmse    standard    2.63     5   0.182 Iter6           6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">5</span>  25.3   0.248   rmse    standard    3.17     5   0.678 Preprocess…     0</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># specifying `initial` as a numeric rather than previous tuning results</span></span></span>
<span class="r-in"><span><span class="co"># will result in `tune_bayes` initially evaluating an space-filling</span></span></span>
<span class="r-in"><span><span class="co"># grid using `tune_grid` with `grid = initial`</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">0239</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">svm_init</span> <span class="op">&lt;-</span> <span class="fu">tune_bayes</span><span class="op">(</span><span class="va">svm_mod</span>, <span class="va">car_rec</span>, <span class="va">folds</span>, initial <span class="op">=</span> <span class="fl">6</span>, iter <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="show_best.html">show_best</a></span><span class="op">(</span><span class="va">svm_init</span>, metric <span class="op">=</span> <span class="st">"rmse"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 5 × 9</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    cost rbf_sigma .metric .estimator  mean     n std_err .config .iter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> 12.6     0.109  rmse    standard    2.84     5   0.528 Iter4       4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> 30.8     0.042<span style="text-decoration: underline;">3</span> rmse    standard    3.13     5   0.387 Iter5       5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">3</span> 27.2     0.153  rmse    standard    3.23     5   0.748 Iter6       6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">4</span>  8.33    0.455  rmse    standard    3.23     5   0.655 Iter3       3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">5</span> 23.6     0.877  rmse    standard    3.37     5   0.693 Iter1       1</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p></p><p>Developed by <a href="https://github.com/topepo" class="external-link">Max Kuhn</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

  </div></footer></body></html>

